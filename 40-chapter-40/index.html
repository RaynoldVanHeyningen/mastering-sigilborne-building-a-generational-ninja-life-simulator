
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../39-chapter-39/">
      
      
        <link rel="next" href="../41-chapter-41/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Chapter 6.3: Equipment & Inventory - Inventory Data Structure (C#) - Mastering Sigilborne: Building a Generational Ninja Life Simulator</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="sky" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-63-equipment-inventory-inventory-data-structure-c" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Mastering Sigilborne: Building a Generational Ninja Life Simulator" class="md-header__button md-logo" aria-label="Mastering Sigilborne: Building a Generational Ninja Life Simulator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Mastering Sigilborne: Building a Generational Ninja Life Simulator
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 6.3: Equipment & Inventory - Inventory Data Structure (C#)
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Mastering Sigilborne: Building a Generational Ninja Life Simulator" class="md-nav__button md-logo" aria-label="Mastering Sigilborne: Building a Generational Ninja Life Simulator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Mastering Sigilborne: Building a Generational Ninja Life Simulator
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-chapter-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.1: Project Setup for Godot 4.5 with C#
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-chapter-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.2: The Brain (C#) - Headless Simulation Layer
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-chapter-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.3: The Body (GDScript) - Reactive Presentation Layer
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-chapter-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.4: Directory Structure - Enforcing Separation of Concerns
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-chapter-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.5: Entity Model - Lightweight ECS-lite in C#
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-chapter-6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.6: Component Architecture - Composition over Inheritance
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-chapter-7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.7: Job System & Concurrency - Multithreaded Processing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-chapter-8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.8: Thread Safety - Command Buffers & Double Buffering
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../09-chapter-9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.9: Scene Composition - Standardizing Godot Scenes
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-chapter-10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.10: Naming Conventions & Scene Interfaces
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../11-chapter-11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.11: Animation Event Protocol - Syncing Brain & Body
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../12-chapter-12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.12: Interop Layer - C# to GDScript Communication
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../13-chapter-13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.13: Global State Management - Data Ownership
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../14-chapter-14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.14: Debugging Tools - Console & State Inspector
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../15-chapter-15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.15: Main Loop Execution Order - Tick vs. Frame
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../16-chapter-16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2.1: Input Manager - Capturing Raw Input (GDScript)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../17-chapter-17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2.2: Standard Movement Logic - Velocity & Friction (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../18-chapter-18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2.3: Shift-Sliding Mechanic - Direction Lock (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../19-chapter-19/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2.4: Physics Layer - Hybrid Movement Pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../20-chapter-20/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3.1: Glyph Database - Concepts vs. Symbols (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../21-chapter-21/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3.2: Glyph Discovery System - Player Knowledge State (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../22-chapter-22/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3.3: Glyph Experimentation - Trial & Error Casting (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../23-chapter-23/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3.4: Subtypes & Modifiers - Procedural Nuance for Glyphs (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../24-chapter-24/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3.5: Glyph Acquisition - Teachers & Scrolls (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../25-chapter-25/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4.1: Input Buffer - Storing Glyph Sequences (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../26-chapter-26/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4.2: Combo Resolver - Trie Structure for Spell Detection (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../27-chapter-27/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4.3: Spell Data Architecture - Data-Driven Definitions (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../28-chapter-28/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4.4: Casting State Machine - Player Casting Flow (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../29-chapter-29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4.5: Visual Feedback - Particles & Animations (GDScript)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../30-chapter-30/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.1: Biological Simulation - The Bio-Tick (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../31-chapter-31/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.2: Core Stats (Struct)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../32-chapter-32/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.3: Metabolism System - Dynamic Decay Rates (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../33-chapter-33/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.4: Weather & Environment - Global Environmental State (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../34-chapter-34/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.5: Damage & Recovery Pipeline - Wounds & Status Effects (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../35-chapter-35/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.6: Status Effect Data - Definition vs. Instance (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../36-chapter-36/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.7: Recovery Logic - Health, Stamina, Chakra Regeneration (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../37-chapter-37/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.8: Weather & Environment - Global Environmental State (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../38-chapter-38/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.1: Physics Layer - Hitbox & Hurtbox Detection (GDScript)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../39-chapter-39/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.2: The Math Layer - Damage Calculator (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.3: Equipment & Inventory - Inventory Data Structure (C#)
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.3: Equipment & Inventory - Inventory Data Structure (C#)
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#chapter-63-equipment-inventory-inventory-data-structure-c" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 6.3: Equipment &amp; Inventory - Inventory Data Structure (C#)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 6.3: Equipment &amp; Inventory - Inventory Data Structure (C#)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-the-pure-data-philosophy-of-inventory" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. The Pure Data Philosophy of Inventory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-defining-inventoryitem" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Defining InventoryItem
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-defining-inventorysystemcs" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Defining InventorySystem.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-integrating-inventorysystem-into-gamemanager" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Integrating InventorySystem into GameManager
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Integrating InventorySystem into GameManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-update-eventbuscs-for-playerinventorychangedevent" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1. Update EventBus.cs for PlayerInventoryChangedEvent
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-testing-the-inventory-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Testing the Inventory System
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next Steps
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../41-chapter-41/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.4: Equipment Logic - Recalculating Stats (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../42-chapter-42/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.5: World Boss Mechanics - Multi-Part Entities (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../43-chapter-43/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.6: Titan AI State - Specialized State Machine (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../44-chapter-44/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.1: Perception System - Spatial Hashing (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../45-chapter-45/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.2: The Senses - Vision, Hearing & Chakra Sense (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../46-chapter-46/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.3: Stealth Mechanics - Visibility & Detection Meter (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../47-chapter-47/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.4: Decision Making: Utility AI (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../48-chapter-48/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.5: Ecology Simulation - Virtual Agents (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../49-chapter-49/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.6: Spawning & Despawning - Hydration/Dehydration (Brain & Body)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../50-chapter-50/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.1: Faction System - The Relationship Graph (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../51-chapter-51/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.2: The Simulation Clock - Game Time & Load Balancing (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../52-chapter-52/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.3: Market Simulation - Supply & Demand (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../53-chapter-53/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.4: Trade Routes - Caravans as Arteries (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../54-chapter-54/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.5: Crime & Justice - The Heat System (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../55-chapter-55/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.6: Bounty & Punishment - Escalation & Consequences (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../56-chapter-56/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9.1: Ritual System - Pattern Matching & Execution (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../57-chapter-57/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9.2: Seals & Locks - Logical Locks (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../58-chapter-58/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9.3: Ritual System - Simple, Advanced & Forbidden (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../59-chapter-59/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9.4: Forbidden Contracts & Spirit Contracts (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../60-chapter-60/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9.5: Corruption Pacts & Multi-Life Persistence of Rituals (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#chapter-63-equipment-inventory-inventory-data-structure-c" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 6.3: Equipment &amp; Inventory - Inventory Data Structure (C#)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 6.3: Equipment &amp; Inventory - Inventory Data Structure (C#)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-the-pure-data-philosophy-of-inventory" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. The Pure Data Philosophy of Inventory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-defining-inventoryitem" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Defining InventoryItem
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-defining-inventorysystemcs" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Defining InventorySystem.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-integrating-inventorysystem-into-gamemanager" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Integrating InventorySystem into GameManager
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Integrating InventorySystem into GameManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-update-eventbuscs-for-playerinventorychangedevent" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1. Update EventBus.cs for PlayerInventoryChangedEvent
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-testing-the-inventory-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Testing the Inventory System
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next Steps
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Chapter 6.3: Equipment & Inventory - Inventory Data Structure (C#)</h1>

<h2 id="chapter-63-equipment-inventory-inventory-data-structure-c">Chapter 6.3: Equipment &amp; Inventory - Inventory Data Structure (C#)</h2>
<p>With combat mechanics taking shape, entities will need items: weapons, tools, consumables, and quest items. This chapter focuses on designing the core <strong>Inventory Data Structure</strong> in the C# Brain. We'll define <code>InventoryItem</code> and <code>InventorySystem</code>, ensuring that inventory is managed as pure data, decoupled from any UI, and designed for efficiency and scalability, as specified in TDD 04.4.</p>
<h3 id="1-the-pure-data-philosophy-of-inventory">1. The Pure Data Philosophy of Inventory</h3>
<p>The TDD (04.4) explicitly states: "Inventory is a pure data structure, not a list of UI nodes." This is crucial for our Brain &amp; Body architecture:</p>
<ul>
<li><strong>Brain (C#) owns Data</strong>: The <code>InventorySystem</code> in C# holds the authoritative truth about what items an entity possesses.</li>
<li><strong>Body (GDScript) owns UI</strong>: The UI will query the Brain for inventory data and display it reactively.</li>
<li><strong>Performance</strong>: Managing thousands of items as pure data is far more efficient than as Godot nodes.</li>
<li><strong>Flexibility</strong>: Easily supports different inventory sizes, item types, and complex item properties.</li>
</ul>
<h3 id="2-defining-inventoryitem">2. Defining <code>InventoryItem</code></h3>
<p><code>InventoryItem</code> will be a struct representing a single slot or stack of items.</p>
<ol>
<li>Create <code>res://_Brain/Systems/Inventory/InventoryItem.cs</code>:</li>
</ol>
<pre><code class="language-csharp">// _Brain/Systems/Inventory/InventoryItem.cs
using System;
using System.Collections.Generic;
using Godot; // For Variant, if using Godot's Variant type for metadata

namespace Sigilborne.Systems.Inventory
{
    /// &lt;summary&gt;
    /// Data for a single item stack within an inventory.
    /// (TDD 04.4.1)
    /// &lt;/summary&gt;
    public struct InventoryItem : IEquatable&lt;InventoryItem&gt;
    {
        public string ItemID;           // Unique ID of the item (e.g., &quot;iron_sword&quot;, &quot;healing_potion_t1&quot;)
        public int Quantity;            // Number of items in this stack
        public float Durability;        // Current durability (for weapons, tools)
        public Dictionary&lt;string, Variant&gt; Metadata; // For enchantments, unique item stats (TDD 04.4.1)

        public InventoryItem(string itemID, int quantity = 1, float durability = 100f, Dictionary&lt;string, Variant&gt; metadata = null)
        {
            ItemID = itemID;
            Quantity = quantity;
            Durability = durability;
            Metadata = metadata ?? new Dictionary&lt;string, Variant&gt;();
        }

        public bool IsEmpty()
        {
            return string.IsNullOrEmpty(ItemID) || Quantity &lt;= 0;
        }

        public override string ToString()
        {
            if (IsEmpty()) return &quot;Empty Slot&quot;;
            return $&quot;{ItemID} (x{Quantity}) Dur:{Durability:F0}% {string.Join(&quot;, &quot;, Metadata.Select(kv =&gt; $&quot;{kv.Key}:{kv.Value}&quot;))}&quot;;
        }

        // --- IEquatable Implementation ---
        public bool Equals(InventoryItem other)
        {
            // For inventory purposes, two items are &quot;equal&quot; if they can stack.
            // This usually means same ItemID, and sometimes same metadata (e.g., enchantments).
            // For simplicity, we'll just check ItemID and Metadata keys for now.
            return ItemID == other.ItemID &amp;&amp;
                   Durability == other.Durability &amp;&amp; // Durability might prevent stacking if not full
                   Metadata.OrderBy(kv =&gt; kv.Key).SequenceEqual(other.Metadata.OrderBy(kv =&gt; kv.Key));
        }

        public override bool Equals(object obj)
        {
            return obj is InventoryItem other &amp;&amp; Equals(other);
        }

        public override int GetHashCode()
        {
            // Simple hash code. For production, consider a more robust one if metadata is complex.
            return HashCode.Combine(ItemID, Durability, Metadata.GetHashCode());
        }
    }
}
</code></pre>
<h3 id="3-defining-inventorysystemcs">3. Defining <code>InventorySystem.cs</code></h3>
<p>This system will manage the inventories of all entities that possess one.</p>
<ol>
<li>Create <code>res://_Brain/Systems/Inventory/InventorySystem.cs</code>:</li>
</ol>
<pre><code class="language-csharp">// _Brain/Systems/Inventory/InventorySystem.cs
using Godot;
using System;
using System.Collections.Generic;
using Sigilborne.Core;
using Sigilborne.Entities;
using System.Linq;

namespace Sigilborne.Systems.Inventory
{
    /// &lt;summary&gt;
    /// Manages the inventories for all entities that possess one.
    /// (TDD 04.4.1)
    /// &lt;/summary&gt;
    public class InventorySystem
    {
        private EntityManager _entityManager;
        private EventBus _eventBus;

        // Dictionary to store inventories for entities.
        // Each entity's inventory is a fixed-size array of InventoryItem.
        private Dictionary&lt;EntityID, InventoryItem[]&gt; _inventories = new Dictionary&lt;EntityID, InventoryItem[]&gt;();

        // Default inventory size for new entities
        private const int DEFAULT_INVENTORY_SIZE = 16; // GDD B13.19: Inventory management (weight, slots)

        public InventorySystem(EntityManager entityManager, EventBus eventBus)
        {
            _entityManager = entityManager;
            _eventBus = eventBus;

            // Subscribe to entity lifecycle events
            _eventBus.OnEntitySpawned += OnEntitySpawned;
            _eventBus.OnEntityDespawned += OnEntityDespawned;

            GD.Print(&quot;InventorySystem: Initialized.&quot;);
        }

        private void OnEntitySpawned(EntityID id, EntityType type, string definitionID, Vector2 initialPosition, float initialRotation)
        {
            // Only add inventory to entities that should have one (Player, NPC, some WorldObjects)
            if (type == EntityType.Player || type == EntityType.NPC || type == EntityType.WorldObject)
            {
                _inventories.Add(id, new InventoryItem[DEFAULT_INVENTORY_SIZE]);
                GD.Print($&quot;InventorySystem: Added inventory for {type} entity {id} with {DEFAULT_INVENTORY_SIZE} slots.&quot;);

                // For player, publish initial inventory state
                if (id == _entityManager.GetPlayerEntityID())
                {
                    _eventBus.Publish(new PlayerInventoryChangedEvent { PlayerID = id, Inventory = GetInventory(id).ToList() });
                }
            }
        }

        private void OnEntityDespawned(EntityManager.EntityDespawnedEvent e)
        {
            _inventories.Remove(e.ID);
            GD.Print($&quot;InventorySystem: Removed inventory for {e.ID}.&quot;);
        }

        /// &lt;summary&gt;
        /// Adds an item to an entity's inventory. Stacks if possible.
        /// (TDD 04.4.1)
        /// &lt;/summary&gt;
        /// &lt;returns&gt;True if item was added, false if inventory is full.&lt;/returns&gt;
        public bool AddItem(EntityID targetID, InventoryItem item)
        {
            if (!_entityManager.IsValid(targetID) || !_inventories.TryGetValue(targetID, out InventoryItem[] inventory))
            {
                GD.PrintErr($&quot;InventorySystem: Entity {targetID} has no inventory.&quot;);
                return false;
            }

            if (item.IsEmpty()) return false;

            // Try to stack with existing items
            for (int i = 0; i &lt; inventory.Length; i++)
            {
                if (!inventory[i].IsEmpty() &amp;&amp; inventory[i].Equals(item)) // If same item type and can stack
                {
                    inventory[i].Quantity += item.Quantity;
                    GD.Print($&quot;InventorySystem: Added {item.ItemID} (x{item.Quantity}) to {targetID}. Stacked.&quot;);
                    _eventBus.Publish(new PlayerInventoryChangedEvent { PlayerID = targetID, Inventory = GetInventory(targetID).ToList() });
                    return true;
                }
            }

            // Find first empty slot
            for (int i = 0; i &lt; inventory.Length; i++)
            {
                if (inventory[i].IsEmpty())
                {
                    inventory[i] = item;
                    GD.Print($&quot;InventorySystem: Added {item.ItemID} (x{item.Quantity}) to {targetID}. New slot.&quot;);
                    _eventBus.Publish(new PlayerInventoryChangedEvent { PlayerID = targetID, Inventory = GetInventory(targetID).ToList() });
                    return true;
                }
            }

            GD.Print($&quot;InventorySystem: Inventory for {targetID} is full. Cannot add {item.ItemID}.&quot;);
            return false; // Inventory is full
        }

        /// &lt;summary&gt;
        /// Removes an item from a specific inventory slot.
        /// (TDD 04.4.1)
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;slotIndex&quot;&gt;The index of the slot to remove from.&lt;/param&gt;
        /// &lt;param name=&quot;quantity&quot;&gt;The amount to remove. If less than current quantity, reduces stack. If more, clears slot.&lt;/param&gt;
        /// &lt;returns&gt;True if item was removed/quantity reduced, false if slot invalid or item not found.&lt;/returns&gt;
        public bool RemoveItem(EntityID targetID, int slotIndex, int quantity = 1)
        {
            if (!_entityManager.IsValid(targetID) || !_inventories.TryGetValue(targetID, out InventoryItem[] inventory))
            {
                GD.PrintErr($&quot;InventorySystem: Entity {targetID} has no inventory.&quot;);
                return false;
            }

            if (slotIndex &lt; 0 || slotIndex &gt;= inventory.Length || inventory[slotIndex].IsEmpty())
            {
                GD.PrintErr($&quot;InventorySystem: Invalid slot {slotIndex} or empty slot for {targetID}.&quot;);
                return false;
            }

            if (quantity &gt;= inventory[slotIndex].Quantity)
            {
                GD.Print($&quot;InventorySystem: Removed all {inventory[slotIndex].ItemID} from slot {slotIndex} for {targetID}.&quot;);
                inventory[slotIndex] = new InventoryItem(); // Clear slot
            }
            else
            {
                inventory[slotIndex].Quantity -= quantity;
                GD.Print($&quot;InventorySystem: Removed {quantity} of {inventory[slotIndex].ItemID} from slot {slotIndex} for {targetID}. New quantity: {inventory[slotIndex].Quantity}.&quot;);
            }
            _eventBus.Publish(new PlayerInventoryChangedEvent { PlayerID = targetID, Inventory = GetInventory(targetID).ToList() });
            return true;
        }

        /// &lt;summary&gt;
        /// Retrieves the current inventory of an entity.
        /// &lt;/summary&gt;
        public IReadOnlyList&lt;InventoryItem&gt; GetInventory(EntityID targetID)
        {
            if (_inventories.TryGetValue(targetID, out InventoryItem[] inventory))
            {
                return inventory.AsEnumerable().ToList().AsReadOnly();
            }
            return new List&lt;InventoryItem&gt;().AsReadOnly();
        }

        /// &lt;summary&gt;
        /// Retrieves the item in a specific inventory slot.
        /// &lt;/summary&gt;
        public InventoryItem GetItemInSlot(EntityID targetID, int slotIndex)
        {
            if (_inventories.TryGetValue(targetID, out InventoryItem[] inventory) &amp;&amp; slotIndex &gt;= 0 &amp;&amp; slotIndex &lt; inventory.Length)
            {
                return inventory[slotIndex];
            }
            return new InventoryItem(); // Return empty item
        }

        // --- Helper Events for Body Sync ---
        // Using List&lt;InventoryItem&gt; for GDScript interop (TDD 04.4.1)
        public struct PlayerInventoryChangedEvent { public EntityID PlayerID; public List&lt;InventoryItem&gt; Inventory; }
    }
}
</code></pre>
<h3 id="4-integrating-inventorysystem-into-gamemanager">4. Integrating <code>InventorySystem</code> into <code>GameManager</code></h3>
<ol>
<li>Add <code>using Sigilborne.Systems.Inventory;</code> at the top of <code>_Brain/Core/GameManager.cs</code>.</li>
<li>Add an <code>InventorySystem</code> property.</li>
<li>Initialize <code>InventorySystem</code> in <code>InitializeSystems()</code>.</li>
</ol>
<pre><code class="language-csharp">// _Brain/Core/GameManager.cs
using Godot;
using System;
using Sigilborne.Core;
using Sigilborne.Entities;
using Sigilborne.Systems;
using Sigilborne.Systems.Biology;
using Sigilborne.Systems.Input;
using Sigilborne.Systems.Movement;
using Sigilborne.Systems.Physics;
using Sigilborne.Systems.Magic;
using Sigilborne.Systems.Weather;
using Sigilborne.Systems.StatusEffects;
using Sigilborne.Systems.Combat;
using Sigilborne.Systems.Inventory; // Add this using directive
using Sigilborne.Utils;
using System.Linq;
using Sigilborne.Systems.Magic.Components;

public partial class GameManager : Node
{
    public static GameManager Instance { get; private set; }

    // ... (existing system properties) ...
    public CombatSystem Combat { get; private set; }
    public InventorySystem Inventory { get; private set; } // Add InventorySystem property

    public override void _Ready()
    {
        // ... (existing Instance check and InitializeSystems call) ...
        // ... (existing test entity/job code) ...
        // ... (existing glyph and magic system tests) ...
        // ... (existing damage tests) ...

        // --- Test Inventory System ---
        GD.Print(&quot;\n--- Testing Inventory System ---&quot;);
        EntityID playerID = Entities.GetPlayerEntityID();

        // Add some items
        Inventory.AddItem(playerID, new InventoryItem(&quot;iron_sword_t1&quot;, 1, 95f));
        Inventory.AddItem(playerID, new InventoryItem(&quot;healing_potion_t1&quot;, 3));
        Inventory.AddItem(playerID, new InventoryItem(&quot;iron_sword_t1&quot;, 1, 95f)); // Should stack
        Inventory.AddItem(playerID, new InventoryItem(&quot;healing_potion_t1&quot;, 5)); // Should stack
        Inventory.AddItem(playerID, new InventoryItem(&quot;mana_potion_t1&quot;, 2));
        Inventory.AddItem(playerID, new InventoryItem(&quot;quest_item_ancient_scroll&quot;, 1, 100f, new Dictionary&lt;string, Variant&gt; { { &quot;lore&quot;, &quot;ancient_text&quot; } }));

        // Remove items
        Inventory.RemoveItem(playerID, 0, 1); // Remove 1 iron sword
        Inventory.RemoveItem(playerID, 1, 8); // Try to remove 8 potions from a stack of 8 (should clear)
        Inventory.RemoveItem(playerID, 99, 1); // Try to remove from invalid slot (should fail)

        GD.Print($&quot;Player Inventory after tests: {string.Join(&quot;\n  &quot;, Inventory.GetInventory(playerID).Select(item =&gt; item.ToString()))}&quot;);
        GD.Print(&quot;--- End Testing Inventory System ---\n&quot;);
    }

    public override void _PhysicsProcess(double delta)
    {
        // ... (existing _PhysicsProcess calls) ...
    }

    private void InitializeSystems()
    {
        // ... (existing system initializations up to CombatSystem) ...

        // Initialize InventorySystem
        Inventory = new InventorySystem(Entities, Events); // Initialize InventorySystem here
        GD.Print(&quot;  - InventorySystem initialized.&quot;);

        // Initialize PlayerStatSystem, passing BiologicalSystem
        PlayerStats = new PlayerStatSystem(Events, Entities, BiologicalSystem);
        GD.Print(&quot;  - PlayerStatSystem initialized.&quot;);

        World = new WorldSimulation();
        GD.Print(&quot;  - WorldSimulation initialized.&quot;);
    }
}
</code></pre>
<h4 id="41-update-eventbuscs-for-playerinventorychangedevent">4.1. Update <code>EventBus.cs</code> for <code>PlayerInventoryChangedEvent</code></h4>
<p>Open <code>res://_Brain/Core/EventBus.cs</code> and add <code>OnPlayerInventoryChanged</code> delegate:</p>
<pre><code class="language-csharp">// _Brain/Core/EventBus.cs
using System;
using System.Collections.Concurrent;
using Godot;
using Sigilborne.Entities;
using Sigilborne.Systems.Biology;
using Sigilborne.Systems.Magic;
using Sigilborne.Systems.StatusEffects;
using Sigilborne.Systems.Combat;
using Sigilborne.Systems.Inventory; // Add this using directive
using System.Collections.Generic;

namespace Sigilborne.Core
{
    public class EventBus
    {
        // ... (existing events) ...

        // Inventory System Events (TDD 04.4.1)
        public event Action&lt;EntityID, List&lt;InventoryItem&gt;&gt; OnPlayerInventoryChanged; // PlayerID, List&lt;InventoryItem&gt;

        // ... (existing _commandBuffer) ...

        public void Publish&lt;TEvent&gt;(TEvent eventData)
        {
            // ... (existing publish conditions) ...
            else if (eventData is InventorySystem.PlayerInventoryChangedEvent inventoryEvent) // New condition
            {
                OnPlayerInventoryChanged?.Invoke(inventoryEvent.PlayerID, inventoryEvent.Inventory);
            }
            else
            {
                GD.PrintErr($&quot;EventBus: Attempted to publish unknown event type: {typeof(TEvent).Name}. Ensure it's handled in Publish&lt;TEvent&gt;.&quot;);
            }
        }
        // ... (AddCommand and FlushCommands methods) ...
    }
}
</code></pre>
<h3 id="5-testing-the-inventory-system">5. Testing the Inventory System</h3>
<ol>
<li>Save all C# and GDScript files.</li>
<li>Run <code>Main.tscn</code>.</li>
<li>Load <code>Gameplay.tscn</code>.</li>
<li>Observe the console output for the "Testing Inventory System" section.</li>
</ol>
<pre><code>...
InventorySystem: Initialized.
  - InventorySystem initialized.
PlayerStatSystem: Initialized.
PlayerStatSystem: Player EntityID(0, Gen:1) took 0 damage. New Health: 100.0
...
--- Testing Inventory System ---
InventorySystem: Added iron_sword_t1 (x1) to EntityID(0, Gen:1). New slot.
InventorySystem: Added healing_potion_t1 (x3) to EntityID(0, Gen:1). New slot.
InventorySystem: Added iron_sword_t1 (x1) to EntityID(0, Gen:1). Stacked.
InventorySystem: Added healing_potion_t1 (x5) to EntityID(0, Gen:1). Stacked.
InventorySystem: Added mana_potion_t1 (x2) to EntityID(0, Gen:1). New slot.
InventorySystem: Added quest_item_ancient_scroll (x1) to EntityID(0, Gen:1). New slot.
InventorySystem: Removed 1 of iron_sword_t1 from slot 0 for EntityID(0, Gen:1). New quantity: 1.
InventorySystem: Removed all healing_potion_t1 from slot 1 for EntityID(0, Gen:1).
InventorySystem: Invalid slot 99 or empty slot for EntityID(0, Gen:1).
Player Inventory after tests: iron_sword_t1 (x1) Dur:95%
  Empty Slot
  mana_potion_t1 (x2) Dur:100%
  quest_item_ancient_scroll (x1) Dur:100% lore:ancient_text
  Empty Slot
  ... (remaining empty slots) ...
--- End Testing Inventory System ---
...
</code></pre>
<p>This output confirms that:
*   <code>InventorySystem</code> correctly initializes inventories for entities.
*   <code>AddItem</code> successfully adds items to empty slots and stacks identical items.
*   <code>RemoveItem</code> correctly reduces stack quantities or clears slots.
*   Invalid operations (full inventory, invalid slot) are handled gracefully.
*   <code>PlayerInventoryChangedEvent</code> is published on every change.</p>
<h3 id="summary">Summary</h3>
<p>You have successfully designed and implemented the core <strong>Inventory Data Structure</strong> in the C# Brain, defining <code>InventoryItem</code> as a struct and <code>InventorySystem</code> to manage item stacks for entities. By ensuring inventory is pure data, decoupled from UI, and capable of adding, stacking, and removing items efficiently, you've established the authoritative backbone for all item management, strictly adhering to TDD 04.4's specifications. This crucial step supports varied equipment, consumables, and quest items in Sigilborne.</p>
<h3 id="next-steps">Next Steps</h3>
<p>The next chapter will focus on <strong>Equipment Logic</strong>, detailing how items are moved to "Equipment Slots," how <code>CoreStats</code> are recalculated when equipment changes, and how the GDScript Body visually updates to reflect equipped items.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.sections", "navigation.expand", "content.code.copy"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>