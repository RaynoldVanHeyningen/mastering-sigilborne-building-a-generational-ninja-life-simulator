
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../05-chapter-5/">
      
      
        <link rel="next" href="../07-chapter-7/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Chapter 1.6: Component Architecture - Composition over Inheritance - Mastering Sigilborne: Building a Generational Ninja Life Simulator</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="sky" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-16-component-architecture-composition-over-inheritance" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Mastering Sigilborne: Building a Generational Ninja Life Simulator" class="md-header__button md-logo" aria-label="Mastering Sigilborne: Building a Generational Ninja Life Simulator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Mastering Sigilborne: Building a Generational Ninja Life Simulator
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 1.6: Component Architecture - Composition over Inheritance
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Mastering Sigilborne: Building a Generational Ninja Life Simulator" class="md-nav__button md-logo" aria-label="Mastering Sigilborne: Building a Generational Ninja Life Simulator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Mastering Sigilborne: Building a Generational Ninja Life Simulator
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-chapter-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.1: Project Setup for Godot 4.5 with C#
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-chapter-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.2: The Brain (C#) - Headless Simulation Layer
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-chapter-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.3: The Body (GDScript) - Reactive Presentation Layer
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-chapter-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.4: Directory Structure - Enforcing Separation of Concerns
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-chapter-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.5: Entity Model - Lightweight ECS-lite in C#
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.6: Component Architecture - Composition over Inheritance
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.6: Component Architecture - Composition over Inheritance
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#chapter-16-component-architecture-composition-over-inheritance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 1.6: Component Architecture - Composition over Inheritance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 1.6: Component Architecture - Composition over Inheritance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-understanding-component-based-design" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Understanding Component-Based Design
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-component-storage-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Component Storage Strategy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-core-components-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Core Components Implementation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Core Components Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-transformcomponentcs" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 TransformComponent.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-typecomponentcs" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 TypeComponent.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-statecomponentcs" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3 StateComponent.cs
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-component-storage-and-retrieval-within-systems" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Component Storage and Retrieval within Systems
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-integrating-transformsystem-into-gamemanager" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Integrating TransformSystem into GameManager
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-testing-component-attachment-and-retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Testing Component Attachment and Retrieval
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next Steps
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-chapter-7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.7: Job System & Concurrency - Multithreaded Processing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-chapter-8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.8: Thread Safety - Command Buffers & Double Buffering
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../09-chapter-9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.9: Scene Composition - Standardizing Godot Scenes
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-chapter-10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.10: Naming Conventions & Scene Interfaces
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../11-chapter-11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.11: Animation Event Protocol - Syncing Brain & Body
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../12-chapter-12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.12: Interop Layer - C# to GDScript Communication
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../13-chapter-13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.13: Global State Management - Data Ownership
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../14-chapter-14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.14: Debugging Tools - Console & State Inspector
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../15-chapter-15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.15: Main Loop Execution Order - Tick vs. Frame
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../16-chapter-16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2.1: Input Manager - Capturing Raw Input (GDScript)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../17-chapter-17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2.2: Standard Movement Logic - Velocity & Friction (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../18-chapter-18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2.3: Shift-Sliding Mechanic - Direction Lock (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../19-chapter-19/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2.4: Physics Layer - Hybrid Movement Pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../20-chapter-20/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3.1: Glyph Database - Concepts vs. Symbols (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../21-chapter-21/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3.2: Glyph Discovery System - Player Knowledge State (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../22-chapter-22/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3.3: Glyph Experimentation - Trial & Error Casting (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../23-chapter-23/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3.4: Subtypes & Modifiers - Procedural Nuance for Glyphs (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../24-chapter-24/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3.5: Glyph Acquisition - Teachers & Scrolls (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../25-chapter-25/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4.1: Input Buffer - Storing Glyph Sequences (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../26-chapter-26/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4.2: Combo Resolver - Trie Structure for Spell Detection (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../27-chapter-27/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4.3: Spell Data Architecture - Data-Driven Definitions (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../28-chapter-28/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4.4: Casting State Machine - Player Casting Flow (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../29-chapter-29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4.5: Visual Feedback - Particles & Animations (GDScript)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../30-chapter-30/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.1: Biological Simulation - The Bio-Tick (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../31-chapter-31/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.2: Core Stats (Struct)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../32-chapter-32/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.3: Metabolism System - Dynamic Decay Rates (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../33-chapter-33/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.4: Weather & Environment - Global Environmental State (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../34-chapter-34/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.5: Damage & Recovery Pipeline - Wounds & Status Effects (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../35-chapter-35/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.6: Status Effect Data - Definition vs. Instance (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../36-chapter-36/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.7: Recovery Logic - Health, Stamina, Chakra Regeneration (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../37-chapter-37/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.8: Weather & Environment - Global Environmental State (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../38-chapter-38/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.1: Physics Layer - Hitbox & Hurtbox Detection (GDScript)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../39-chapter-39/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.2: The Math Layer - Damage Calculator (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../40-chapter-40/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.3: Equipment & Inventory - Inventory Data Structure (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../41-chapter-41/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.4: Equipment Logic - Recalculating Stats (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../42-chapter-42/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.5: World Boss Mechanics - Multi-Part Entities (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../43-chapter-43/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.6: Titan AI State - Specialized State Machine (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../44-chapter-44/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.1: Perception System - Spatial Hashing (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../45-chapter-45/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.2: The Senses - Vision, Hearing & Chakra Sense (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../46-chapter-46/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.3: Stealth Mechanics - Visibility & Detection Meter (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../47-chapter-47/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.4: Decision Making: Utility AI (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../48-chapter-48/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.5: Ecology Simulation - Virtual Agents (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../49-chapter-49/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.6: Spawning & Despawning - Hydration/Dehydration (Brain & Body)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../50-chapter-50/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.1: Faction System - The Relationship Graph (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../51-chapter-51/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.2: The Simulation Clock - Game Time & Load Balancing (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../52-chapter-52/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.3: Market Simulation - Supply & Demand (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../53-chapter-53/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.4: Trade Routes - Caravans as Arteries (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../54-chapter-54/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.5: Crime & Justice - The Heat System (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../55-chapter-55/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.6: Bounty & Punishment - Escalation & Consequences (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../56-chapter-56/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9.1: Ritual System - Pattern Matching & Execution (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../57-chapter-57/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9.2: Seals & Locks - Logical Locks (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../58-chapter-58/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9.3: Ritual System - Simple, Advanced & Forbidden (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../59-chapter-59/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9.4: Forbidden Contracts & Spirit Contracts (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../60-chapter-60/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9.5: Corruption Pacts & Multi-Life Persistence of Rituals (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#chapter-16-component-architecture-composition-over-inheritance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 1.6: Component Architecture - Composition over Inheritance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 1.6: Component Architecture - Composition over Inheritance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-understanding-component-based-design" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Understanding Component-Based Design
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-component-storage-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Component Storage Strategy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-core-components-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Core Components Implementation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Core Components Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-transformcomponentcs" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 TransformComponent.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-typecomponentcs" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 TypeComponent.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-statecomponentcs" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3 StateComponent.cs
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-component-storage-and-retrieval-within-systems" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Component Storage and Retrieval within Systems
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-integrating-transformsystem-into-gamemanager" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Integrating TransformSystem into GameManager
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-testing-component-attachment-and-retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Testing Component Attachment and Retrieval
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next Steps
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Chapter 1.6: Component Architecture - Composition over Inheritance</h1>

<h2 id="chapter-16-component-architecture-composition-over-inheritance">Chapter 1.6: Component Architecture - Composition over Inheritance</h2>
<p>Building upon our <code>EntityID</code> and <code>EntityManager</code>, this chapter dives into the "Component" aspect of our ECS-lite architecture. Components are pure data structures that describe an entity's attributes. By attaching various components to an <code>EntityID</code>, we define its behavior and properties through composition rather than complex inheritance chains. This approach, as per TDD 11.3, promotes flexibility, reusability, and efficient data processing.</p>
<p>We will design and implement <code>TransformComponent</code>, <code>TypeComponent</code>, and <code>StateComponent</code> as our foundational components.</p>
<h3 id="1-understanding-component-based-design">1. Understanding Component-Based Design</h3>
<p>In an ECS-lite, an entity is just an ID. Its capabilities come from the components attached to it.</p>
<p><strong>Key Principles of Components:</strong></p>
<ul>
<li><strong>Pure Data</strong>: Components should primarily contain data, not logic. Logic resides in "Systems" that operate on components.</li>
<li><strong>Small and Focused</strong>: Each component should represent a single, clear aspect of an entity (e.g., <code>TransformComponent</code> for position, <code>HealthComponent</code> for health).</li>
<li><strong>Composition</strong>: An entity gets its behavior by composing multiple components. A <code>Player</code> entity might have <code>TransformComponent</code>, <code>HealthComponent</code>, <code>InputComponent</code>, and <code>InventoryComponent</code>. A <code>Projectile</code> might only have <code>TransformComponent</code> and <code>DamageComponent</code>.</li>
<li><strong>Reusability</strong>: Components can be reused across vastly different entity types.</li>
<li><strong>Cache-Friendliness</strong>: Storing components of the same type together (e.g., all <code>TransformComponents</code> in one array) improves CPU cache performance when systems iterate over them.</li>
</ul>
<h3 id="2-component-storage-strategy">2. Component Storage Strategy</h3>
<p>TDD 11.3 outlines two primary patterns for component storage:</p>
<ul>
<li><strong>Structure of Arrays (SoA)</strong>: For "hot path" components that are frequently iterated over (like <code>TransformComponent</code>, <code>VelocityComponent</code>), we store them in large arrays. This is excellent for cache locality.</li>
<li><strong>Dictionary</strong>: For "sparse" components that only a subset of entities possess (like <code>InventoryComponent</code>, <code>ManaComponent</code>), a <code>Dictionary&lt;EntityID, ComponentData&gt;</code> is more memory-efficient.</li>
</ul>
<p>For our core components, <code>TransformComponent</code> will likely be SoA-like (stored in a system that iterates all transforms), while <code>TypeComponent</code> and <code>StateComponent</code> will be direct metadata or part of the <code>EntityManager</code>'s internal structure.</p>
<p>Let's create the <code>_Brain/Entities/Components</code> folder if you haven't already.</p>
<h3 id="3-core-components-implementation">3. Core Components Implementation</h3>
<h4 id="31-transformcomponentcs">3.1 <code>TransformComponent.cs</code></h4>
<p>Every entity in our game world will have a position and rotation. This component is fundamental for movement, rendering, and spatial queries.</p>
<p>Create <code>res://_Brain/Entities/Components/TransformComponent.cs</code>:</p>
<pre><code class="language-csharp">// _Brain/Entities/Components/TransformComponent.cs
using Godot; // For Vector2

namespace Sigilborne.Entities.Components
{
    /// &lt;summary&gt;
    /// Stores the position and rotation of an entity in world space.
    /// This is a common component for all spatially aware entities.
    /// &lt;/summary&gt;
    public struct TransformComponent
    {
        public Vector2 Position;
        public float RotationDegrees; // Rotation in degrees

        public TransformComponent(Vector2 position, float rotationDegrees = 0f)
        {
            Position = position;
            RotationDegrees = rotationDegrees;
        }

        public override string ToString()
        {
            return $&quot;Pos: {Position}, Rot: {RotationDegrees}Â°&quot;;
        }
    }
}
</code></pre>
<p><strong>Note</strong>: We use Godot's <code>Vector2</code> struct directly here. While the TDD mentions the Brain should be headless, <code>Vector2</code> is a fundamental mathematical type for 2D games, and its inclusion doesn't tie the Brain to Godot's visual nodes.</p>
<h4 id="32-typecomponentcs">3.2 <code>TypeComponent.cs</code></h4>
<p>This component defines the broad category of an entity. We've already implicitly defined this with <code>EntityType</code> in <code>EntityManager.cs</code>, so we can consider <code>EntityType</code> itself as the <code>TypeComponent</code> data, stored directly within <code>EntityMeta</code>.</p>
<p>To formalize this, ensure your <code>EntityManager.cs</code> explicitly uses the <code>EntityType</code> enum. (We already did this in Chapter 1.5).</p>
<pre><code class="language-csharp">// Excerpt from _Brain/Entities/EntityManager.cs
// ...
    public struct EntityMeta
    {
        public int Generation;
        public bool IsActive;
        public EntityType Type; // This is our TypeComponent data
        public string DefinitionID;
    }
// ...
    public enum EntityType // This enum defines the possible types
    {
        Player,
        NPC,
        Animal,
        Projectile,
        Item,
        WorldObject,
        Effect,
        Invalid
    }
// ...
</code></pre>
<h4 id="33-statecomponentcs">3.3 <code>StateComponent.cs</code></h4>
<p>This component holds various boolean flags that describe an entity's current state (e.g., active, sleeping, dead).</p>
<p>Create <code>res://_Brain/Entities/Components/StateComponent.cs</code>:</p>
<pre><code class="language-csharp">// _Brain/Entities/Components/StateComponent.cs
namespace Sigilborne.Entities.Components
{
    /// &lt;summary&gt;
    /// Stores various boolean flags representing an entity's current state.
    /// &lt;/summary&gt;
    public struct StateComponent
    {
        public bool IsActive;    // Whether the entity is currently active in the simulation (beyond EntityManager's IsActive)
        public bool IsSleeping;  // For NPCs/Animals
        public bool IsDead;      // For all living entities
        public bool IsStunned;   // For combat
        public bool IsInvisible; // For stealth

        public StateComponent(bool isActive = true)
        {
            IsActive = isActive;
            IsSleeping = false;
            IsDead = false;
            IsStunned = false;
            IsInvisible = false;
        }

        public override string ToString()
        {
            return $&quot;Active: {IsActive}, Sleeping: {IsSleeping}, Dead: {IsDead}, Stunned: {IsStunned}, Invisible: {IsInvisible}&quot;;
        }
    }
}
</code></pre>
<h3 id="4-component-storage-and-retrieval-within-systems">4. Component Storage and Retrieval within Systems</h3>
<p>Now, let's consider how a "System" would manage these components. For <code>TransformComponent</code>, which almost all entities will have, a dedicated <code>TransformSystem</code> would store them efficiently. For <code>StateComponent</code>, we can store it similarly, or integrate some flags directly into <code>EntityMeta</code> for very common states.</p>
<p>Let's create a placeholder <code>TransformSystem</code> to demonstrate component management.</p>
<p>Create <code>res://_Brain/Systems/TransformSystem.cs</code>:</p>
<pre><code class="language-csharp">// _Brain/Systems/TransformSystem.cs
using Godot;
using System;
using System.Collections.Generic;
using Sigilborne.Core;
using Sigilborne.Entities;
using Sigilborne.Entities.Components;

namespace Sigilborne.Systems
{
    /// &lt;summary&gt;
    /// Manages all TransformComponents for active entities.
    /// Example of a system that holds its own component data.
    /// &lt;/summary&gt;
    public class TransformSystem
    {
        // TDD 11.3: SoA Pattern - Dictionary for sparse data, but still efficient for many entities.
        // For very high performance (millions of entities), this might be a NativeArray&lt;TransformComponent&gt;
        // and a separate NativeArray&lt;EntityID&gt; for indices.
        private Dictionary&lt;EntityID, TransformComponent&gt; _transforms = new Dictionary&lt;EntityID, TransformComponent&gt;();
        private EntityManager _entityManager; // Reference to validate EntityIDs

        public TransformSystem(EntityManager entityManager, EventBus eventBus)
        {
            _entityManager = entityManager;
            // Subscribe to entity lifecycle events to manage transforms
            eventBus.OnEntitySpawned += OnEntitySpawned;
            eventBus.OnEntityDespawned += OnEntityDespawned;
            GD.Print(&quot;TransformSystem: Initialized.&quot;);
        }

        // --- Event Handlers for Entity Lifecycle ---
        private void OnEntitySpawned(EntityManager.EntitySpawnedEvent e)
        {
            // All entities get a TransformComponent by default for simplicity in this example
            // In a real game, only spatially aware entities would get one.
            _transforms.Add(e.ID, new TransformComponent(Vector2.Zero)); // Default position
            GD.Print($&quot;TransformSystem: Added transform for {e.ID}&quot;);
        }

        private void OnEntityDespawned(EntityManager.EntityDespawnedEvent e)
        {
            if (_transforms.ContainsKey(e.ID))
            {
                _transforms.Remove(e.ID);
                GD.Print($&quot;TransformSystem: Removed transform for {e.ID}&quot;);
            }
        }

        // --- Public API for Systems to Access/Modify Transforms ---

        /// &lt;summary&gt;
        /// Attempts to get the TransformComponent for a given entity.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;True if the component exists and is retrieved, false otherwise.&lt;/returns&gt;
        public bool TryGetTransform(EntityID id, out TransformComponent transform)
        {
            if (!_entityManager.IsValid(id))
            {
                transform = default;
                return false;
            }
            return _transforms.TryGetValue(id, out transform);
        }

        /// &lt;summary&gt;
        /// Attempts to set the TransformComponent for a given entity.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;True if the component exists and is set, false otherwise.&lt;/returns&gt;
        public bool TrySetTransform(EntityID id, TransformComponent transform)
        {
            if (!_entityManager.IsValid(id) || !_transforms.ContainsKey(id))
            {
                return false;
            }
            _transforms[id] = transform;
            return true;
        }

        /// &lt;summary&gt;
        /// Provides a mutable reference to the TransformComponent for direct modification.
        /// Use with caution and ensure the ID is valid.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;A ref to the TransformComponent.&lt;/returns&gt;
        /// &lt;exception cref=&quot;InvalidOperationException&quot;&gt;If the entity is invalid or doesn't have a transform.&lt;/exception&gt;
        public ref TransformComponent GetTransformRef(EntityID id)
        {
            if (!_entityManager.IsValid(id) || !_transforms.ContainsKey(id))
            {
                throw new InvalidOperationException($&quot;Entity {id} is invalid or does not have a TransformComponent.&quot;);
            }
            return ref _transforms.GetValueRef(id); // GetValueRef is a C# 7.0+ feature for ref return from Dictionary
        }

        // --- Tick Method (if this system needs to update transforms) ---
        public void Tick(double delta)
        {
            // Example: A simple movement system would iterate here
            // foreach (var kvp in _transforms)
            // {
            //     // Get velocity component from another system
            //     // kvp.Value.Position += velocity * delta;
            // }
        }
    }
}
</code></pre>
<p><strong>Note on <code>GetValueRef()</code></strong>: This is a C# 7.0+ feature that allows returning a <code>ref</code> to a value in a <code>Dictionary</code>. If you're using an older C# version or prefer not to use <code>ref</code> returns, you would get a copy of the struct, modify it, and then set it back: <code>_transforms[id] = modifiedTransform;</code>.</p>
<h3 id="5-integrating-transformsystem-into-gamemanager">5. Integrating TransformSystem into GameManager</h3>
<p>Now, let's add <code>TransformSystem</code> to our <code>GameManager</code>.</p>
<p>Open <code>_Brain/Core/GameManager.cs</code> and modify it:</p>
<ol>
<li>Add <code>using Sigilborne.Systems;</code> at the top.</li>
<li>Add a <code>TransformSystem</code> property.</li>
<li>Initialize <code>TransformSystem</code> in <code>InitializeSystems()</code>, passing <code>Entities</code> and <code>Events</code>.</li>
<li>Call <code>TransformSystem.Tick(delta)</code> in <code>_PhysicsProcess</code>.</li>
</ol>
<pre><code class="language-csharp">// _Brain/Core/GameManager.cs
using Godot;
using System;
using Sigilborne.Core;
using Sigilborne.Entities;
using Sigilborne.Systems; // Add this using directive

public partial class GameManager : Node
{
    public static GameManager Instance { get; private set; }

    public TimeSystem Time { get; private set; }
    public EventBus Events { get; private set; }
    public WorldSimulation World { get; private set; }
    public EntityManager Entities { get; private set; }
    public TransformSystem Transforms { get; private set; } // Add TransformSystem property

    public override void _Ready()
    {
        if (Instance != null)
        {
            GD.PrintErr(&quot;GameManager: More than one instance detected! Destroying duplicate.&quot;);
            QueueFree();
            return;
        }
        Instance = this;

        InitializeSystems();

        GD.Print(&quot;GameManager (C#) initialized and ready.&quot;);

        // --- Test Scene Loading ---
        if (SceneLoader.instance != null)
        {
            GD.Print(&quot;GameManager: Requesting SceneLoader to load Gameplay scene.&quot;);
            SceneLoader.instance.load_level(&quot;res://_Body/Scenes/Gameplay.tscn&quot;);
        }
        else
        {
            GD.PrintErr(&quot;GameManager: SceneLoader instance not found! Cannot load gameplay scene.&quot;);
        }
        // --- End Test Scene Loading ---
    }

    public override void _PhysicsProcess(double delta)
    {
        Time.Tick(delta);
        Events.FlushCommands();
        World.Tick(delta);
        Transforms.Tick(delta); // Call TransformSystem's tick method
    }

    private void InitializeSystems()
    {
        Events = new EventBus();
        GD.Print(&quot;  - EventBus initialized.&quot;);

        Time = new TimeSystem();
        GD.Print(&quot;  - TimeSystem initialized.&quot;);

        Entities = new EntityManager(Events);
        GD.Print(&quot;  - EntityManager initialized.&quot;);

        // Initialize TransformSystem, passing EntityManager and EventBus
        Transforms = new TransformSystem(Entities, Events); // Initialize TransformSystem here
        GD.Print(&quot;  - TransformSystem initialized.&quot;);

        World = new WorldSimulation();
        GD.Print(&quot;  - WorldSimulation initialized.&quot;);
    }
}
</code></pre>
<h3 id="6-testing-component-attachment-and-retrieval">6. Testing Component Attachment and Retrieval</h3>
<p>Let's modify our entity testing in <code>GameManager._Ready()</code> to demonstrate setting and getting a <code>TransformComponent</code>.</p>
<pre><code class="language-csharp">// _Brain/Core/GameManager.cs (inside _Ready method, replace previous test entity code)
// ...
        // --- Test Entity Management &amp; Components ---
        GD.Print(&quot;\n--- Testing Entity Management &amp; Components ---&quot;);
        EntityID playerEntity = Entities.CreateEntity(EntityType.Player, &quot;player_default&quot;);
        GD.Print($&quot;Created Player: {playerEntity}. IsValid: {Entities.IsValid(playerEntity)}&quot;);

        // Set player's initial position
        Transforms.TrySetTransform(playerEntity, new TransformComponent(new Vector2(100, 50), 45f));
        if (Transforms.TryGetTransform(playerEntity, out TransformComponent playerTransform))
        {
            GD.Print($&quot;Player {playerEntity} Transform: {playerTransform}&quot;);
        }

        // Get a ref and modify directly
        ref TransformComponent playerTransformRef = ref Transforms.GetTransformRef(playerEntity);
        playerTransformRef.Position = new Vector2(150, 75);
        playerTransformRef.RotationDegrees = 90f;
        GD.Print($&quot;Player {playerEntity} New Transform (via ref): {Transforms.GetTransformRef(playerEntity)}&quot;);


        EntityID npcEntity = Entities.CreateEntity(EntityType.NPC, &quot;goblin_grunt&quot;);
        GD.Print($&quot;Created NPC: {npcEntity}. IsValid: {Entities.IsValid(npcEntity)}&quot;);
        // NPCs also get a default transform via OnEntitySpawned

        Entities.DestroyEntity(playerEntity);
        GD.Print($&quot;Destroyed Player: {playerEntity}. IsValid: {Entities.IsValid(playerEntity)}&quot;);

        // Attempt to get transform for destroyed entity (should fail gracefully)
        if (!Transforms.TryGetTransform(playerEntity, out TransformComponent destroyedTransform))
        {
            GD.Print($&quot;Attempted to get transform for destroyed entity {playerEntity}, it correctly failed.&quot;);
        }

        GD.Print(&quot;--- End Testing Entity Management &amp; Components ---\n&quot;);
// ...
</code></pre>
<p>Save all C# files and run <code>Main.tscn</code>. The output should now reflect the component creation, modification, and proper removal upon entity destruction.</p>
<pre><code>--- Testing Entity Management &amp; Components ---
EntityManager: Created Player entity EntityID(0, Gen:1) (Def: player_default)
TransformSystem: Added transform for EntityID(0, Gen:1)
Created Player: EntityID(0, Gen:1). IsValid: True
Player EntityID(0, Gen:1) Transform: Pos: (100, 50), Rot: 45Â°
Player EntityID(0, Gen:1) New Transform (via ref): Pos: (150, 75), Rot: 90Â°
EntityManager: Created NPC entity EntityID(1, Gen:1) (Def: goblin_grunt)
TransformSystem: Added transform for EntityID(1, Gen:1)
Created NPC: EntityID(1, Gen:1). IsValid: True
EntityManager: Destroyed entity EntityID(0, Gen:1).
TransformSystem: Removed transform for EntityID(0, Gen:1)
Destroyed Player: EntityID(0, Gen:1). IsValid: False
Attempted to get transform for destroyed entity EntityID(0, Gen:1), it correctly failed.
--- End Testing Entity Management &amp; Components ---
</code></pre>
<h3 id="summary">Summary</h3>
<p>You have successfully implemented the foundational components (<code>TransformComponent</code>, <code>TypeComponent</code>, <code>StateComponent</code>) for Sigilborne's ECS-lite architecture, emphasizing composition over inheritance. By designing a <code>TransformSystem</code> that manages <code>TransformComponent</code> data and integrates with <code>EntityManager</code>'s lifecycle events, you've established a flexible and efficient system for defining entity properties. This crucial step adheres to TDD 11's specifications, providing a scalable and performant way to manage thousands of entities in our simulation.</p>
<h3 id="next-steps">Next Steps</h3>
<p>With our core entity and component architecture in place, the next module will tackle the Job System and Concurrency, enabling our Brain to perform heavy tasks like ecology simulation and world generation across multiple threads without impacting performance.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.sections", "navigation.expand", "content.code.copy"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>