
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../12-chapter-12/">
      
      
        <link rel="next" href="../14-chapter-14/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Chapter 1.13: Global State Management - Data Ownership - Mastering Sigilborne: Building a Generational Ninja Life Simulator</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="sky" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-113-global-state-management-data-ownership" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Mastering Sigilborne: Building a Generational Ninja Life Simulator" class="md-header__button md-logo" aria-label="Mastering Sigilborne: Building a Generational Ninja Life Simulator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Mastering Sigilborne: Building a Generational Ninja Life Simulator
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 1.13: Global State Management - Data Ownership
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Mastering Sigilborne: Building a Generational Ninja Life Simulator" class="md-nav__button md-logo" aria-label="Mastering Sigilborne: Building a Generational Ninja Life Simulator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Mastering Sigilborne: Building a Generational Ninja Life Simulator
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-chapter-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.1: Project Setup for Godot 4.5 with C#
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-chapter-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.2: The Brain (C#) - Headless Simulation Layer
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-chapter-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.3: The Body (GDScript) - Reactive Presentation Layer
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-chapter-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.4: Directory Structure - Enforcing Separation of Concerns
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-chapter-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.5: Entity Model - Lightweight ECS-lite in C#
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-chapter-6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.6: Component Architecture - Composition over Inheritance
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-chapter-7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.7: Job System & Concurrency - Multithreaded Processing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-chapter-8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.8: Thread Safety - Command Buffers & Double Buffering
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../09-chapter-9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.9: Scene Composition - Standardizing Godot Scenes
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-chapter-10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.10: Naming Conventions & Scene Interfaces
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../11-chapter-11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.11: Animation Event Protocol - Syncing Brain & Body
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../12-chapter-12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.12: Interop Layer - C# to GDScript Communication
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.13: Global State Management - Data Ownership
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.13: Global State Management - Data Ownership
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#chapter-113-global-state-management-data-ownership" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 1.13: Global State Management - Data Ownership
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 1.13: Global State Management - Data Ownership">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-the-principle-of-authoritative-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. The Principle of Authoritative State
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-global-state-examples-and-their-brain-owners" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Global State Examples and Their Brain Owners
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-implementing-a-basic-player-stat-system-brain" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Implementing a Basic Player Stat System (Brain)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-integrating-playerstatsystem-into-gamemanager" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Integrating PlayerStatSystem into GameManager
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Integrating PlayerStatSystem into GameManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-update-eventbuscs-for-playerstatsystem-events" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1. Update EventBus.cs for PlayerStatSystem Events
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-displaying-player-stats-in-the-body-gdscript-ui" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Displaying Player Stats in the Body (GDScript UI)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-testing-global-state-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Testing Global State Management
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next Steps
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../14-chapter-14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.14: Debugging Tools - Console & State Inspector
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../15-chapter-15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.15: Main Loop Execution Order - Tick vs. Frame
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../16-chapter-16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2.1: Input Manager - Capturing Raw Input (GDScript)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../17-chapter-17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2.2: Standard Movement Logic - Velocity & Friction (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../18-chapter-18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2.3: Shift-Sliding Mechanic - Direction Lock (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../19-chapter-19/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2.4: Physics Layer - Hybrid Movement Pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../20-chapter-20/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3.1: Glyph Database - Concepts vs. Symbols (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../21-chapter-21/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3.2: Glyph Discovery System - Player Knowledge State (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../22-chapter-22/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3.3: Glyph Experimentation - Trial & Error Casting (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../23-chapter-23/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3.4: Subtypes & Modifiers - Procedural Nuance for Glyphs (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../24-chapter-24/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3.5: Glyph Acquisition - Teachers & Scrolls (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../25-chapter-25/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4.1: Input Buffer - Storing Glyph Sequences (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../26-chapter-26/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4.2: Combo Resolver - Trie Structure for Spell Detection (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../27-chapter-27/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4.3: Spell Data Architecture - Data-Driven Definitions (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../28-chapter-28/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4.4: Casting State Machine - Player Casting Flow (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../29-chapter-29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4.5: Visual Feedback - Particles & Animations (GDScript)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../30-chapter-30/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.1: Biological Simulation - The Bio-Tick (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../31-chapter-31/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.2: Core Stats (Struct)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../32-chapter-32/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.3: Metabolism System - Dynamic Decay Rates (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../33-chapter-33/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.4: Weather & Environment - Global Environmental State (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../34-chapter-34/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.5: Damage & Recovery Pipeline - Wounds & Status Effects (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../35-chapter-35/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.6: Status Effect Data - Definition vs. Instance (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../36-chapter-36/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.7: Recovery Logic - Health, Stamina, Chakra Regeneration (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../37-chapter-37/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.8: Weather & Environment - Global Environmental State (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../38-chapter-38/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.1: Physics Layer - Hitbox & Hurtbox Detection (GDScript)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../39-chapter-39/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.2: The Math Layer - Damage Calculator (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../40-chapter-40/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.3: Equipment & Inventory - Inventory Data Structure (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../41-chapter-41/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.4: Equipment Logic - Recalculating Stats (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../42-chapter-42/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.5: World Boss Mechanics - Multi-Part Entities (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../43-chapter-43/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.6: Titan AI State - Specialized State Machine (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../44-chapter-44/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.1: Perception System - Spatial Hashing (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../45-chapter-45/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.2: The Senses - Vision, Hearing & Chakra Sense (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../46-chapter-46/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.3: Stealth Mechanics - Visibility & Detection Meter (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../47-chapter-47/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.4: Decision Making: Utility AI (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../48-chapter-48/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.5: Ecology Simulation - Virtual Agents (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../49-chapter-49/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.6: Spawning & Despawning - Hydration/Dehydration (Brain & Body)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../50-chapter-50/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.1: Faction System - The Relationship Graph (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../51-chapter-51/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.2: The Simulation Clock - Game Time & Load Balancing (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../52-chapter-52/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.3: Market Simulation - Supply & Demand (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../53-chapter-53/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.4: Trade Routes - Caravans as Arteries (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../54-chapter-54/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.5: Crime & Justice - The Heat System (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../55-chapter-55/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.6: Bounty & Punishment - Escalation & Consequences (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../56-chapter-56/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9.1: Ritual System - Pattern Matching & Execution (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../57-chapter-57/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9.2: Seals & Locks - Logical Locks (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../58-chapter-58/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9.3: Ritual System - Simple, Advanced & Forbidden (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../59-chapter-59/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9.4: Forbidden Contracts & Spirit Contracts (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../60-chapter-60/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9.5: Corruption Pacts & Multi-Life Persistence of Rituals (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#chapter-113-global-state-management-data-ownership" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 1.13: Global State Management - Data Ownership
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 1.13: Global State Management - Data Ownership">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-the-principle-of-authoritative-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. The Principle of Authoritative State
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-global-state-examples-and-their-brain-owners" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Global State Examples and Their Brain Owners
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-implementing-a-basic-player-stat-system-brain" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Implementing a Basic Player Stat System (Brain)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-integrating-playerstatsystem-into-gamemanager" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Integrating PlayerStatSystem into GameManager
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Integrating PlayerStatSystem into GameManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-update-eventbuscs-for-playerstatsystem-events" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1. Update EventBus.cs for PlayerStatSystem Events
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-displaying-player-stats-in-the-body-gdscript-ui" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Displaying Player Stats in the Body (GDScript UI)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-testing-global-state-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Testing Global State Management
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next Steps
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Chapter 1.13: Global State Management - Data Ownership</h1>

<h2 id="chapter-113-global-state-management-data-ownership">Chapter 1.13: Global State Management - Data Ownership</h2>
<p>In Sigilborne's hybrid architecture, maintaining a consistent and authoritative game state is paramount. This chapter formalizes the principle of <strong>data ownership</strong>: the C# Brain is the sole owner of all authoritative game data, while the GDScript Body never "owns" data, it only displays it. This strict separation, as outlined in TDD 01.4, prevents data desynchronization, simplifies debugging, and reinforces the Brain &amp; Body paradigm.</p>
<h3 id="1-the-principle-of-authoritative-state">1. The Principle of Authoritative State</h3>
<ul>
<li><strong>Brain (C#)</strong>: Owns the <strong>Model</strong> (the data) and the <strong>Controller</strong> (the logic that changes the data).<ul>
<li><em>Examples</em>: Player's actual health, inventory contents, NPC positions, world time, faction relationships, quest states.</li>
<li><em>Rule</em>: All changes to the game state <em>must</em> originate from or be validated by the Brain.</li>
</ul>
</li>
<li><strong>Body (GDScript)</strong>: Owns the <strong>View</strong>. It receives updates from the Brain and renders them.<ul>
<li><em>Examples</em>: Player's visual health bar, inventory UI, animated NPC sprite at an interpolated position, UI display of world time.</li>
<li><em>Rule</em>: The Body never modifies the authoritative game state directly. It only requests changes from the Brain (e.g., via GDScript-to-C# method calls for player input).</li>
</ul>
</li>
</ul>
<p>This single source of truth is crucial for determinism, especially if we were to introduce multiplayer.</p>
<h3 id="2-global-state-examples-and-their-brain-owners">2. Global State Examples and Their Brain Owners</h3>
<p>Let's look at key game data and identify their authoritative owners within our C# Brain, as per TDD 01.4.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Data Type</th>
<th style="text-align: left;">Owner (C# System)</th>
<th style="text-align: left;">Example Data</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Player Stats</strong></td>
<td style="text-align: left;"><code>BiologicalSystem</code> (Soon)</td>
<td style="text-align: left;"><code>Health: 100</code>, <code>Chakra: 50</code>, <code>Stamina: 75</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Inventory</strong></td>
<td style="text-align: left;"><code>InventorySystem</code> (Soon)</td>
<td style="text-align: left;"><code>[ItemID: "iron_sword", Qty: 1]</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>World Time</strong></td>
<td style="text-align: left;"><code>TimeSystem</code> (Implemented)</td>
<td style="text-align: left;"><code>Day: 4</code>, <code>Hour: 14</code>, <code>Minute: 0</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>NPC Positions</strong></td>
<td style="text-align: left;"><code>TransformSystem</code> (Implemented)</td>
<td style="text-align: left;"><code>EntityID(1).Position: (40, 20)</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Weather</strong></td>
<td style="text-align: left;"><code>WeatherSystem</code> (Soon)</td>
<td style="text-align: left;"><code>CurrentWeather: Rain</code>, <code>Temperature: 15</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Quest State</strong></td>
<td style="text-align: left;"><code>QuestSystem</code> (Soon)</td>
<td style="text-align: left;"><code>QuestID("main_01").Status: Active</code></td>
</tr>
</tbody>
</table>
<p>The <code>GameManager.Instance</code> acts as the central hub to access these owning systems.</p>
<h3 id="3-implementing-a-basic-player-stat-system-brain">3. Implementing a Basic Player Stat System (Brain)</h3>
<p>To demonstrate data ownership, let's create a very simple <code>PlayerStatSystem</code> in C# that manages the player's health. This will be an early step towards our <code>BiologicalSystem</code> (TDD 03.2).</p>
<ol>
<li>Create a new folder <code>res://_Brain/Systems/Biology/</code>.</li>
<li>Create a new C# script <code>res://_Brain/Systems/Biology/PlayerStatSystem.cs</code>:</li>
</ol>
<pre><code class="language-csharp">// _Brain/Systems/Biology/PlayerStatSystem.cs
using Godot;
using System;
using Sigilborne.Core;
using Sigilborne.Entities;

namespace Sigilborne.Systems.Biology
{
    /// &lt;summary&gt;
    /// Stores the core stats for the player entity.
    /// This is a component-like data structure managed by the PlayerStatSystem.
    /// &lt;/summary&gt;
    public struct PlayerStats
    {
        public EntityID PlayerID;
        public float Health;
        public float MaxHealth;
        public float Chakra;
        public float MaxChakra;
        public float Stamina;
        public float MaxStamina;

        public PlayerStats(EntityID id, float maxHealth, float maxChakra, float maxStamina)
        {
            PlayerID = id;
            MaxHealth = maxHealth;
            Health = maxHealth;
            MaxChakra = maxChakra;
            Chakra = maxChakra;
            MaxStamina = maxStamina;
            Stamina = maxStamina;
        }

        public override string ToString()
        {
            return $&quot;Health: {Health}/{MaxHealth}, Chakra: {Chakra}/{MaxChakra}, Stamina: {Stamina}/{MaxStamina}&quot;;
        }
    }

    /// &lt;summary&gt;
    /// Manages the player's core biological stats.
    /// This is the authoritative owner of the player's health, chakra, etc.
    /// &lt;/summary&gt;
    public class PlayerStatSystem
    {
        private PlayerStats _playerStats;
        private EventBus _eventBus;
        private EntityManager _entityManager;

        public PlayerStatSystem(EventBus eventBus, EntityManager entityManager)
        {
            _eventBus = eventBus;
            _entityManager = entityManager;
            GD.Print(&quot;PlayerStatSystem: Initialized.&quot;);

            // Listen for when the player entity is actually spawned
            _eventBus.OnEntitySpawned += OnEntitySpawned;
        }

        private void OnEntitySpawned(EntityID id, EntityType type, string definitionID, Vector2 initialPosition, float initialRotation)
        {
            if (type == EntityType.Player)
            {
                // Initialize player stats when the player entity is created
                _playerStats = new PlayerStats(id, 100f, 50f, 75f);
                GD.Print($&quot;PlayerStatSystem: Initialized stats for player {id}: {_playerStats}&quot;);

                // Publish an event for the Body to display the initial health
                _eventBus.Publish(new PlayerHealthChangedEvent { PlayerID = id, NewHealth = _playerStats.Health, MaxHealth = _playerStats.MaxHealth });
            }
        }

        /// &lt;summary&gt;
        /// Retrieves a copy of the player's current stats.
        /// &lt;/summary&gt;
        public PlayerStats GetPlayerStats()
        {
            return _playerStats;
        }

        /// &lt;summary&gt;
        /// Authoritatively applies damage to the player's health.
        /// &lt;/summary&gt;
        public void TakeDamage(float amount)
        {
            if (_playerStats.Health &lt;= 0) return; // Already dead

            _playerStats.Health -= amount;
            if (_playerStats.Health &lt; 0) _playerStats.Health = 0;

            GD.Print($&quot;PlayerStatSystem: Player {_playerStats.PlayerID} took {amount} damage. New Health: {_playerStats.Health}&quot;);

            // Publish an event for the Body (UI) to update the health bar
            _eventBus.Publish(new PlayerHealthChangedEvent { PlayerID = _playerStats.PlayerID, NewHealth = _playerStats.Health, MaxHealth = _playerStats.MaxHealth });

            if (_playerStats.Health == 0)
            {
                GD.Print($&quot;PlayerStatSystem: Player {_playerStats.PlayerID} has died!&quot;);
                _eventBus.Publish(new PlayerDiedEvent { PlayerID = _playerStats.PlayerID });
            }
        }

        // --- Helper Events for Body Sync ---
        public struct PlayerHealthChangedEvent { public EntityID PlayerID; public float NewHealth; public float MaxHealth; }
        public struct PlayerDiedEvent { public EntityID PlayerID; }
    }
}
</code></pre>
<h3 id="4-integrating-playerstatsystem-into-gamemanager">4. Integrating <code>PlayerStatSystem</code> into <code>GameManager</code></h3>
<ol>
<li>Add <code>using Sigilborne.Systems.Biology;</code> at the top of <code>_Brain/Core/GameManager.cs</code>.</li>
<li>Add a <code>PlayerStatSystem</code> property.</li>
<li>Initialize <code>PlayerStatSystem</code> in <code>InitializeSystems()</code>.</li>
</ol>
<pre><code class="language-csharp">// _Brain/Core/GameManager.cs
using Godot;
using System;
using Sigilborne.Core;
using Sigilborne.Entities;
using Sigilborne.Systems;
using Sigilborne.Systems.Biology; // Add this using directive
using Sigilborne.Utils;

public partial class GameManager : Node
{
    public static GameManager Instance { get; private set; }

    public TimeSystem Time { get; private set; }
    public EventBus Events { get; private set; }
    public WorldSimulation World { get; private set; }
    public EntityManager Entities { get; private set; }
    public TransformSystem Transforms { get; private set; }
    public JobSystem Jobs { get; private set; }
    public PlayerStatSystem PlayerStats { get; private set; } // Add PlayerStatSystem property

    public override void _Ready()
    {
        // ... (existing Instance check and InitializeSystems call) ...

        // --- Test Scene Loading ---
        // ... (existing SceneLoader call) ...
        // --- End Test Scene Loading ---

        // --- Test Entity Management &amp; Components ---
        GD.Print(&quot;\n--- Testing Entity Management &amp; Components ---&quot;);
        // Create the player entity (this will trigger PlayerStatSystem to initialize stats)
        EntityID playerEntity = Entities.CreateEntity(EntityType.Player, &quot;player_default&quot;, new Vector2(200, 200), 0f);
        GD.Print($&quot;Created Player: {playerEntity}. IsValid: {Entities.IsValid(playerEntity)}&quot;);

        EntityID npcEntity = Entities.CreateEntity(EntityType.NPC, &quot;goblin_grunt&quot;, new Vector2(100, 100), 90f);
        GD.Print($&quot;Created NPC: {npcEntity}. IsValid: {Entities.IsValid(npcEntity)}&quot;);

        // Let's not destroy playerEntity immediately to test damage later
        // Entities.DestroyEntity(playerEntity);
        // GD.Print($&quot;Destroyed Player: {playerEntity}. IsValid: {Entities.IsValid(playerEntity)}&quot;);

        // if (!Transforms.TryGetTransform(playerEntity, out TransformComponent destroyedTransform))
        // {
        //     GD.Print($&quot;Attempted to get transform for destroyed entity {playerEntity}, it correctly failed.&quot;);
        // }

        GD.Print(&quot;--- End Testing Entity Management &amp; Components ---\n&quot;);

        // --- Test JobSystem ---
        // ... (existing JobSystem tests) ...
        // --- End Testing JobSystem ---

        // --- Test PlayerStatSystem (Damage) ---
        GD.Print(&quot;\n--- Testing PlayerStatSystem ---&quot;);
        PlayerStats.TakeDamage(10f); // Player takes damage
        PlayerStats.TakeDamage(20f);
        PlayerStats.TakeDamage(70f); // Should kill the player
        GD.Print(&quot;--- End Testing PlayerStatSystem ---\n&quot;);
    }

    public override void _PhysicsProcess(double delta)
    {
        Time.Tick(delta);
        Events.FlushCommands();
        World.Tick(delta);
        Transforms.Tick(delta);
        // PlayerStatSystem doesn't have a Tick method for now, its updates are event/command driven.
    }

    private void InitializeSystems()
    {
        Events = new EventBus();
        GD.Print(&quot;  - EventBus initialized.&quot;);

        Time = new TimeSystem();
        GD.Print(&quot;  - TimeSystem initialized.&quot;);

        Entities = new EntityManager(Events);
        GD.Print(&quot;  - EntityManager initialized.&quot;);

        Transforms = new TransformSystem(Entities, Events);
        GD.Print(&quot;  - TransformSystem initialized.&quot;);

        Jobs = new JobSystem(Events);
        GD.Print(&quot;  - JobSystem initialized.&quot;);

        PlayerStats = new PlayerStatSystem(Events, Entities); // Initialize PlayerStatSystem here
        GD.Print(&quot;  - PlayerStatSystem initialized.&quot;);

        World = new WorldSimulation();
        GD.Print(&quot;  - WorldSimulation initialized.&quot;);
    }
}
</code></pre>
<h4 id="41-update-eventbuscs-for-playerstatsystem-events">4.1. Update <code>EventBus.cs</code> for PlayerStatSystem Events</h4>
<p>Our <code>PlayerStatSystem</code> publishes <code>PlayerHealthChangedEvent</code> and <code>PlayerDiedEvent</code>. We need to define these <code>Action</code> delegates in <code>EventBus</code>.</p>
<p>Open <code>_Brain/Core/EventBus.cs</code>:</p>
<pre><code class="language-csharp">// _Brain/Core/EventBus.cs
using System;
using System.Collections.Concurrent;
using Godot;
using Sigilborne.Entities;
using Sigilborne.Systems.Biology; // Add this using directive
using System.Collections.Generic;

namespace Sigilborne.Core
{
    public class EventBus
    {
        // ... (existing events) ...

        // Player Stat Events (TDD 01.4)
        public event Action&lt;EntityID, float, float&gt; OnPlayerHealthChanged;
        public event Action&lt;EntityID&gt; OnPlayerDied;

        // ... (existing _commandBuffer) ...

        public void Publish&lt;TEvent&gt;(TEvent eventData)
        {
            // ... (existing publish conditions) ...
            else if (eventData is PlayerStatSystem.PlayerHealthChangedEvent healthEvent) // New condition
            {
                OnPlayerHealthChanged?.Invoke(healthEvent.PlayerID, healthEvent.NewHealth, healthEvent.MaxHealth);
            }
            else if (eventData is PlayerStatSystem.PlayerDiedEvent diedEvent) // New condition
            {
                OnPlayerDied?.Invoke(diedEvent.PlayerID);
            }
            else
            {
                GD.PrintErr($&quot;EventBus: Attempted to publish unknown event type: {typeof(TEvent).Name}. Ensure it's handled in Publish&lt;TEvent&gt;.&quot;);
            }
        }
        // ... (AddCommand and FlushCommands methods) ...
    }
}
</code></pre>
<h3 id="5-displaying-player-stats-in-the-body-gdscript-ui">5. Displaying Player Stats in the Body (GDScript UI)</h3>
<p>Now, let's create a simple UI (Body) to display the player's health, reacting to <code>OnPlayerHealthChanged</code> events.</p>
<ol>
<li>Create a new folder <code>res://_Body/Scenes/UI/</code>.</li>
<li>Create a new scene <code>res://_Body/Scenes/UI/HUD.tscn</code>:<ul>
<li>Root node: <code>CanvasLayer</code>. Rename it <code>HUD</code>.</li>
<li>Child node: <code>HBoxContainer</code>. Rename it <code>HealthBarContainer</code>.<ul>
<li>In Inspector, set <code>Anchor Preset</code> to <code>Top Wide</code> (or adjust layout as desired).</li>
<li>Set <code>Position</code> (e.g., <code>x=10, y=10</code>).</li>
</ul>
</li>
<li>Child of <code>HealthBarContainer</code>: <code>Label</code>. Rename it <code>HealthLabel</code>.<ul>
<li>Set <code>Text</code> to <code>Health: 100/100</code>.</li>
</ul>
</li>
</ul>
</li>
<li>Attach a new GDScript to the <code>HUD</code> node: <code>res://_Body/Scripts/UI/HUDController.gd</code>.</li>
</ol>
<pre><code class="language-gdscript"># _Body/Scripts/UI/HUDController.gd
class_name HUDController extends CanvasLayer

@onready var health_label: Label = $HealthBarContainer/HealthLabel

var player_entity_id: int = -1 # Store the player's EntityID.Index

func _ready():
    GD.print(&quot;HUDController: Initialized. Connecting to C# PlayerStatSystem events.&quot;)
    # Connect to C# PlayerStatSystem events
    if GameManager.Instance != null and GameManager.Instance.Events != null:
        GameManager.Instance.Events.OnPlayerHealthChanged.connect(Callable(self, &quot;_on_player_health_changed&quot;))
        GameManager.Instance.Events.OnPlayerDied.connect(Callable(self, &quot;_on_player_died&quot;))
        # We also need to know the player's EntityID when it spawns
        GameManager.Instance.Events.OnEntitySpawned.connect(Callable(self, &quot;_on_entity_spawned&quot;))
        GD.print(&quot;HUDController: Successfully connected to C# PlayerStatSystem events.&quot;)
    else:
        push_error(&quot;HUDController: GameManager or EventBus not ready! Cannot connect C# events.&quot;)

func _on_entity_spawned(id: int, type: int, definition_id: String, initial_position: Vector2, initial_rotation: float) -&gt; void:
    # Only care about the Player entity here
    # Godot's C# binding marshals EntityType enum as an int, so we compare to its integer value.
    if type == 0: # EntityType.Player has value 0
        player_entity_id = id
        GD.print(&quot;HUDController: Detected player entity with ID: %s&quot; % player_entity_id)

## Handler for C# PlayerHealthChangedEvent.
func _on_player_health_changed(id: int, new_health: float, max_health: float) -&gt; void:
    # Only update if it's our player's health
    if id == player_entity_id:
        health_label.text = &quot;Health: %s/%s&quot; % [int(new_health), int(max_health)]
        GD.print(&quot;HUDController: Player %s Health Updated to %s/%s&quot; % [id, int(new_health), int(max_health)])

## Handler for C# PlayerDiedEvent.
func _on_player_died(id: int) -&gt; void:
    if id == player_entity_id:
        health_label.text = &quot;Health: DEAD&quot;
        GD.print(&quot;HUDController: Player %s has died visually!&quot; % id)
</code></pre>
<p>Now, instantiate the <code>HUD.tscn</code> scene into <code>res://Gameplay.tscn</code>:</p>
<ol>
<li>Open <code>res://Gameplay.tscn</code>.</li>
<li>Add a new instance of <code>res://_Body/Scenes/UI/HUD.tscn</code> as a child of the <code>Gameplay</code> root node.</li>
<li>Save <code>Gameplay.tscn</code>.</li>
</ol>
<h3 id="6-testing-global-state-management">6. Testing Global State Management</h3>
<ol>
<li>Save all C# and GDScript files.</li>
<li>Run <code>Main.tscn</code>.</li>
</ol>
<p><strong>Expected Output:</strong></p>
<ul>
<li>The game loads <code>Gameplay.tscn</code>.</li>
<li>The <code>HUD</code> will appear with "Health: 100/100".</li>
<li>In the Output console, you'll see the <code>PlayerStatSystem</code> messages about damage taken.</li>
<li>The <code>HUD</code>'s health label will update <code>Health: 90/100</code>, then <code>Health: 70/100</code>, and finally <code>Health: DEAD</code>.</li>
</ul>
<p>This demonstrates:</p>
<ul>
<li>The C# Brain (<code>PlayerStatSystem</code>) authoritatively owns and modifies player health.</li>
<li>The C# Brain publishes events when health changes.</li>
<li>The GDScript Body (<code>HUDController</code>) listens to these events and reactively updates its UI.</li>
<li>The Body does not directly modify player health; it only displays the state provided by the Brain.</li>
</ul>
<p>This is a perfect example of global state management and data ownership in action.</p>
<h3 id="summary">Summary</h3>
<p>You have successfully implemented a core aspect of Global State Management, ensuring that the C# Brain authoritatively owns all game data, specifically demonstrated with a <code>PlayerStatSystem</code>. By designing <code>PlayerStats</code> and integrating the system with <code>GameManager</code> and <code>EventBus</code>, you've established a clear pipeline for modifying game state in C#. Furthermore, you've created a reactive GDScript <code>HUDController</code> that listens to C# events and displays this state without owning it, strictly adhering to TDD 01.4's principles of data ownership and separation of concerns.</p>
<h3 id="next-steps">Next Steps</h3>
<p>The next chapter will focus on <strong>Debugging Tools</strong>, implementing a console and state inspector to help visualize and manipulate our complex simulation data at runtime, which is essential for developing a large-scale, systemic game like Sigilborne.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.sections", "navigation.expand", "content.code.copy"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>