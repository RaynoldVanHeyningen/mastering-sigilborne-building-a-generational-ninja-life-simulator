
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../34-chapter-34/">
      
      
        <link rel="next" href="../36-chapter-36/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Chapter 5.6: Status Effect Data - Definition vs. Instance (C#) - Mastering Sigilborne: Building a Generational Ninja Life Simulator</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="sky" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-56-status-effect-data-definition-vs-instance-c" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Mastering Sigilborne: Building a Generational Ninja Life Simulator" class="md-header__button md-logo" aria-label="Mastering Sigilborne: Building a Generational Ninja Life Simulator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Mastering Sigilborne: Building a Generational Ninja Life Simulator
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 5.6: Status Effect Data - Definition vs. Instance (C#)
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Mastering Sigilborne: Building a Generational Ninja Life Simulator" class="md-nav__button md-logo" aria-label="Mastering Sigilborne: Building a Generational Ninja Life Simulator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Mastering Sigilborne: Building a Generational Ninja Life Simulator
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-chapter-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.1: Project Setup for Godot 4.5 with C#
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-chapter-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.2: The Brain (C#) - Headless Simulation Layer
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-chapter-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.3: The Body (GDScript) - Reactive Presentation Layer
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-chapter-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.4: Directory Structure - Enforcing Separation of Concerns
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-chapter-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.5: Entity Model - Lightweight ECS-lite in C#
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-chapter-6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.6: Component Architecture - Composition over Inheritance
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-chapter-7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.7: Job System & Concurrency - Multithreaded Processing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-chapter-8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.8: Thread Safety - Command Buffers & Double Buffering
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../09-chapter-9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.9: Scene Composition - Standardizing Godot Scenes
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-chapter-10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.10: Naming Conventions & Scene Interfaces
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../11-chapter-11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.11: Animation Event Protocol - Syncing Brain & Body
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../12-chapter-12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.12: Interop Layer - C# to GDScript Communication
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../13-chapter-13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.13: Global State Management - Data Ownership
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../14-chapter-14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.14: Debugging Tools - Console & State Inspector
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../15-chapter-15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1.15: Main Loop Execution Order - Tick vs. Frame
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../16-chapter-16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2.1: Input Manager - Capturing Raw Input (GDScript)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../17-chapter-17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2.2: Standard Movement Logic - Velocity & Friction (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../18-chapter-18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2.3: Shift-Sliding Mechanic - Direction Lock (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../19-chapter-19/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2.4: Physics Layer - Hybrid Movement Pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../20-chapter-20/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3.1: Glyph Database - Concepts vs. Symbols (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../21-chapter-21/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3.2: Glyph Discovery System - Player Knowledge State (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../22-chapter-22/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3.3: Glyph Experimentation - Trial & Error Casting (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../23-chapter-23/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3.4: Subtypes & Modifiers - Procedural Nuance for Glyphs (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../24-chapter-24/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3.5: Glyph Acquisition - Teachers & Scrolls (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../25-chapter-25/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4.1: Input Buffer - Storing Glyph Sequences (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../26-chapter-26/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4.2: Combo Resolver - Trie Structure for Spell Detection (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../27-chapter-27/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4.3: Spell Data Architecture - Data-Driven Definitions (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../28-chapter-28/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4.4: Casting State Machine - Player Casting Flow (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../29-chapter-29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4.5: Visual Feedback - Particles & Animations (GDScript)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../30-chapter-30/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.1: Biological Simulation - The Bio-Tick (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../31-chapter-31/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.2: Core Stats (Struct)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../32-chapter-32/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.3: Metabolism System - Dynamic Decay Rates (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../33-chapter-33/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.4: Weather & Environment - Global Environmental State (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../34-chapter-34/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.5: Damage & Recovery Pipeline - Wounds & Status Effects (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.6: Status Effect Data - Definition vs. Instance (C#)
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.6: Status Effect Data - Definition vs. Instance (C#)
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#chapter-56-status-effect-data-definition-vs-instance-c" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 5.6: Status Effect Data - Definition vs. Instance (C#)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 5.6: Status Effect Data - Definition vs. Instance (C#)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-the-dual-nature-of-status-effects" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. The Dual Nature of Status Effects
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-defining-effectdefinition" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Defining EffectDefinition
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-defining-activeeffect" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Defining ActiveEffect
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-enhancing-statuseffectsystemcs-with-data-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Enhancing StatusEffectSystem.cs with Data Management
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-integrating-statuseffectsystem-into-gamemanager" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Integrating StatusEffectSystem into GameManager
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-updating-damagesystemcs-to-use-statuseffectsystem" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Updating DamageSystem.cs to use StatusEffectSystem
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-update-eventbuscs-for-status-effect-events" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Update EventBus.cs for Status Effect Events
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-testing-status-effect-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Testing Status Effect Lifecycle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next Steps
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../36-chapter-36/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.7: Recovery Logic - Health, Stamina, Chakra Regeneration (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../37-chapter-37/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5.8: Weather & Environment - Global Environmental State (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../38-chapter-38/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.1: Physics Layer - Hitbox & Hurtbox Detection (GDScript)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../39-chapter-39/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.2: The Math Layer - Damage Calculator (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../40-chapter-40/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.3: Equipment & Inventory - Inventory Data Structure (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../41-chapter-41/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.4: Equipment Logic - Recalculating Stats (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../42-chapter-42/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.5: World Boss Mechanics - Multi-Part Entities (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../43-chapter-43/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6.6: Titan AI State - Specialized State Machine (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../44-chapter-44/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.1: Perception System - Spatial Hashing (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../45-chapter-45/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.2: The Senses - Vision, Hearing & Chakra Sense (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../46-chapter-46/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.3: Stealth Mechanics - Visibility & Detection Meter (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../47-chapter-47/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.4: Decision Making: Utility AI (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../48-chapter-48/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.5: Ecology Simulation - Virtual Agents (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../49-chapter-49/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7.6: Spawning & Despawning - Hydration/Dehydration (Brain & Body)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../50-chapter-50/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.1: Faction System - The Relationship Graph (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../51-chapter-51/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.2: The Simulation Clock - Game Time & Load Balancing (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../52-chapter-52/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.3: Market Simulation - Supply & Demand (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../53-chapter-53/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.4: Trade Routes - Caravans as Arteries (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../54-chapter-54/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.5: Crime & Justice - The Heat System (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../55-chapter-55/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8.6: Bounty & Punishment - Escalation & Consequences (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../56-chapter-56/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9.1: Ritual System - Pattern Matching & Execution (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../57-chapter-57/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9.2: Seals & Locks - Logical Locks (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../58-chapter-58/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9.3: Ritual System - Simple, Advanced & Forbidden (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../59-chapter-59/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9.4: Forbidden Contracts & Spirit Contracts (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../60-chapter-60/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9.5: Corruption Pacts & Multi-Life Persistence of Rituals (C#)
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#chapter-56-status-effect-data-definition-vs-instance-c" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 5.6: Status Effect Data - Definition vs. Instance (C#)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 5.6: Status Effect Data - Definition vs. Instance (C#)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-the-dual-nature-of-status-effects" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. The Dual Nature of Status Effects
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-defining-effectdefinition" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Defining EffectDefinition
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-defining-activeeffect" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Defining ActiveEffect
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-enhancing-statuseffectsystemcs-with-data-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Enhancing StatusEffectSystem.cs with Data Management
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-integrating-statuseffectsystem-into-gamemanager" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Integrating StatusEffectSystem into GameManager
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-updating-damagesystemcs-to-use-statuseffectsystem" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Updating DamageSystem.cs to use StatusEffectSystem
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-update-eventbuscs-for-status-effect-events" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Update EventBus.cs for Status Effect Events
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-testing-status-effect-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Testing Status Effect Lifecycle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next Steps
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Chapter 5.6: Status Effect Data - Definition vs. Instance (C#)</h1>

<h2 id="chapter-56-status-effect-data-definition-vs-instance-c">Chapter 5.6: Status Effect Data - Definition vs. Instance (C#)</h2>
<p>Our <code>DamageSystem</code> can now trigger <code>StatusEffect</code>s (wounds), and our <code>BiologicalSystem</code> manages <code>CoreStats</code>. This chapter focuses on fully implementing the <strong>Status Effect System</strong>, starting with defining <code>EffectDefinition</code> (static data) and <code>ActiveEffect</code> (runtime instance) to manage buffs, debuffs, and wounds. This standardized lifecycle ensures effects are applied, tick, and are cleaned up correctly, preventing bugs like "infinite burn," as specified in TDD 18.2.</p>
<h3 id="1-the-dual-nature-of-status-effects">1. The Dual Nature of Status Effects</h3>
<p>TDD 18.2 distinguishes between:</p>
<ul>
<li><strong><code>EffectDefinition</code></strong>: The static blueprint of an effect (e.g., "Bleed_T1" always lasts 5 seconds, ticks for X damage). This is data.</li>
<li><strong><code>ActiveEffect</code></strong>: A live instance of an effect applied to a specific entity, with its current <code>TimeRemaining</code>, <code>Stacks</code>, and <code>SourceID</code>. This is runtime state.</li>
</ul>
<p>This separation allows for flexible data-driven effect creation and efficient runtime management.</p>
<h3 id="2-defining-effectdefinition">2. Defining <code>EffectDefinition</code></h3>
<p>This will be our static blueprint for all status effects.</p>
<ol>
<li>Open <code>res://_Brain/Systems/StatusEffects/StatusEffectSystem.cs</code> and add <code>EffectDefinition</code> as a nested class (or in its own file if preferred, but for now, nested is fine for cohesion).</li>
</ol>
<pre><code class="language-csharp">// _Brain/Systems/StatusEffects/StatusEffectSystem.cs
using Godot;
using System;
using System.Collections.Generic;
using Sigilborne.Entities;
using Sigilborne.Systems.Magic.Components; // For StatusEffectData
using Sigilborne.Systems.Biology; // For CoreStats
using Sigilborne.Core; // For EventBus

namespace Sigilborne.Systems.StatusEffects
{
    /// &lt;summary&gt;
    /// Defines the types of status effects.
    /// &lt;/summary&gt;
    public enum EffectType
    {
        None,
        DamageOverTime, // DoT
        StatModifier,   // Modifies a stat (e.g., speed, armor)
        Buff,           // Positive stat modifier
        Debuff,         // Negative stat modifier
        HealingOverTime, // HoT
        ChakraDrain,    // Drains chakra over time
        StabilityDrain, // Drains stability over time
        ControlImpair,  // Stun, Root, Slow
        VoidSickness    // Permanent/persistent corruption effect (C04)
    }

    /// &lt;summary&gt;
    /// Static data defining a status effect.
    /// (TDD 18.2.1)
    /// &lt;/summary&gt;
    public class EffectDefinition
    {
        public string ID { get; private set; } // &quot;burn_t1&quot;, &quot;slow_short&quot;
        public EffectType Type { get; private set; }
        public int MaxStacks { get; private set; }
        public float BaseDuration { get; private set; } // Base duration before modifiers
        public float TickRate { get; private set; } // How often the effect &quot;ticks&quot; (for DoT, HoT, etc.)
        public float BaseStrength { get; private set; } // Base magnitude of the effect
        public bool IsPermanent { get; private set; } // TDD 18.4.1: VoidSickness is permanent until cured.
        public string VisualFXID { get; private set; } // ID for Body to play VFX (e.g., &quot;burn_particles&quot;)
        public string SoundFXID { get; private set; } // ID for Body to play SFX

        // For StatModifier effects: which CoreStats field to modify and how
        public string StatToModify { get; private set; } // e.g., &quot;MoveSpeed&quot;, &quot;Armor&quot;
        public float StatModifierValue { get; private set; } // e.g., -0.2 (20% reduction), 10.0 (flat increase)
        public bool IsPercentageModifier { get; private set; } // true for % mod, false for flat

        public EffectDefinition(string id, EffectType type, int maxStacks, float baseDuration, float tickRate, float baseStrength, bool isPermanent = false, string visualFxId = null, string soundFxId = null, string statToModify = null, float statModifierValue = 0f, bool isPercentageModifier = false)
        {
            ID = id;
            Type = type;
            MaxStacks = maxStacks;
            BaseDuration = baseDuration;
            TickRate = tickRate;
            BaseStrength = baseStrength;
            IsPermanent = isPermanent;
            VisualFXID = visualFxId;
            SoundFXID = soundFxId;
            StatToModify = statToModify;
            StatModifierValue = statModifierValue;
            IsPercentageModifier = isPercentageModifier;
        }

        public override string ToString()
        {
            return $&quot;EffectDef: '{ID}' ({Type}) | Str: {BaseStrength}, Dur: {BaseDuration}, Stacks: {MaxStacks}&quot;;
        }
    }
    // ... (rest of StatusEffectSystem class) ...
}
</code></pre>
<h3 id="3-defining-activeeffect">3. Defining <code>ActiveEffect</code></h3>
<p>This represents a live instance of an effect on an entity.</p>
<ol>
<li>Open <code>res://_Brain/Systems/StatusEffects/StatusEffectSystem.cs</code> and add <code>ActiveEffect</code> as a nested struct.</li>
</ol>
<pre><code class="language-csharp">// _Brain/Systems/StatusEffects/StatusEffectSystem.cs
using Godot;
using System;
using System.Collections.Generic;
using Sigilborne.Entities;
using Sigilborne.Systems.Magic.Components; // For StatusEffectData
using Sigilborne.Systems.Biology; // For CoreStats
using Sigilborne.Core; // For EventBus

namespace Sigilborne.Systems.StatusEffects
{
    // ... (EffectType enum) ...
    // ... (EffectDefinition class) ...

    /// &lt;summary&gt;
    /// Represents an active instance of a status effect applied to an entity.
    /// (TDD 18.2.2)
    /// &lt;/summary&gt;
    public struct ActiveEffect
    {
        public EffectDefinition Definition; // Reference to the static definition
        public int Stacks;                  // Current number of stacks (TDD 18.2.2)
        public float TimeRemaining;         // Remaining duration of the effect (TDD 18.2.2)
        public float TimeSinceLastTick;     // For effects that tick periodically
        public EntityID SourceID;           // Who applied this effect (for kill credit, etc.)
        public EntityID TargetID;           // Who has this effect

        public ActiveEffect(EffectDefinition definition, EntityID targetID, EntityID sourceID, float initialDuration, float initialStrength, int initialStacks = 1)
        {
            Definition = definition;
            TargetID = targetID;
            SourceID = sourceID;
            Stacks = initialStacks;
            TimeRemaining = initialDuration;
            TimeSinceLastTick = 0; // Start at 0 for first tick
            // Initial strength from EffectDefinition is used, initialStrength parameter
            // allows for overrides (e.g., spell specific strength).
        }

        public override string ToString()
        {
            return $&quot;ActiveEffect: '{Definition.ID}' | Stacks: {Stacks}, Rem: {TimeRemaining:F1}s&quot;;
        }
    }
    // ... (rest of StatusEffectSystem class) ...
}
</code></pre>
<h3 id="4-enhancing-statuseffectsystemcs-with-data-management">4. Enhancing <code>StatusEffectSystem.cs</code> with Data Management</h3>
<p>Now, let's update <code>StatusEffectSystem</code> to manage a collection of <code>EffectDefinition</code>s and <code>ActiveEffect</code>s.</p>
<ol>
<li>Open <code>res://_Brain/Systems/StatusEffects/StatusEffectSystem.cs</code>.</li>
<li>Modify the class to include dictionaries for definitions and active effects.</li>
<li>Implement <code>RegisterEffectDefinition</code> and <code>ApplyEffect</code>.</li>
<li>Implement the <code>Tick</code> method for the <code>StatusEffectSystem</code> itself.</li>
</ol>
<pre><code class="language-csharp">// _Brain/Systems/StatusEffects/StatusEffectSystem.cs
using Godot;
using System;
using System.Collections.Generic;
using Sigilborne.Entities;
using Sigilborne.Systems.Magic.Components;
using Sigilborne.Systems.Biology;
using Sigilborne.Core;
using System.Linq; // For Any()

namespace Sigilborne.Systems.StatusEffects
{
    // ... (EffectType enum) ...
    // ... (EffectDefinition class) ...
    // ... (ActiveEffect struct) ...

    /// &lt;summary&gt;
    /// Manages the lifecycle and application of all status effects (buffs, debuffs, wounds).
    /// (TDD 03.4, TDD 18)
    /// &lt;/summary&gt;
    public class StatusEffectSystem
    {
        private EntityManager _entityManager;
        private EventBus _eventBus;
        private BiologicalSystem _biologicalSystem; // To modify CoreStats

        // Static definitions of all possible effects
        private Dictionary&lt;string, EffectDefinition&gt; _effectDefinitions = new Dictionary&lt;string, EffectDefinition&gt;();

        // Active effects on entities: Dictionary&lt;EntityID, List&lt;ActiveEffect&gt;&gt;
        // Using a List&lt;ActiveEffect&gt; as an entity can have multiple effects.
        private Dictionary&lt;EntityID, List&lt;ActiveEffect&gt;&gt; _activeEffects = new Dictionary&lt;EntityID, List&lt;ActiveEffect&gt;&gt;();

        public StatusEffectSystem(EntityManager entityManager, EventBus eventBus, BiologicalSystem biologicalSystem)
        {
            _entityManager = entityManager;
            _eventBus = eventBus;
            _biologicalSystem = biologicalSystem;
            GD.Print(&quot;StatusEffectSystem: Initialized.&quot;);

            // Subscribe to entity despawn events to clean up effects
            _eventBus.OnEntityDespawned += OnEntityDespawned;

            RegisterDefaultEffects(); // Register some default effects for testing
        }

        private void OnEntityDespawned(EntityManager.EntityDespawnedEvent e)
        {
            _activeEffects.Remove(e.ID); // Clean up all effects on a despawned entity
            GD.Print($&quot;StatusEffectSystem: Cleared effects for despawned entity {e.ID}.&quot;);
        }

        /// &lt;summary&gt;
        /// Registers a new static EffectDefinition.
        /// &lt;/summary&gt;
        public void RegisterEffectDefinition(EffectDefinition def)
        {
            _effectDefinitions[def.ID] = def;
            GD.Print($&quot;StatusEffectSystem: Registered effect definition '{def.ID}'.&quot;);
        }

        /// &lt;summary&gt;
        /// Registers some common default effects for initial testing.
        /// &lt;/summary&gt;
        private void RegisterDefaultEffects()
        {
            RegisterEffectDefinition(new EffectDefinition(&quot;bleed_t1&quot;, EffectType.DamageOverTime, 3, 5f, 1f, 2f, visualFxId: &quot;bleed_vfx&quot;));
            RegisterEffectDefinition(new EffectDefinition(&quot;burn_t1&quot;, EffectType.DamageOverTime, 5, 3f, 0.5f, 3f, visualFxId: &quot;burn_vfx&quot;));
            RegisterEffectDefinition(new EffectDefinition(&quot;chakra_drain_t1&quot;, EffectType.ChakraDrain, 1, 2f, 0.5f, 5f, visualFxId: &quot;drain_vfx&quot;));
            RegisterEffectDefinition(new EffectDefinition(&quot;void_sickness_t1&quot;, EffectType.VoidSickness, 100, float.MaxValue, 10f, 1f, isPermanent: true, visualFxId: &quot;void_aura_vfx&quot;)); // TDD 18.4.1
            RegisterEffectDefinition(new EffectDefinition(&quot;slow_short&quot;, EffectType.ControlImpair, 1, 3f, 0f, 0.5f, statToModify: &quot;MoveSpeed&quot;, isPercentageModifier: true)); // 50% slow
            RegisterEffectDefinition(new EffectDefinition(&quot;regen_t1&quot;, EffectType.HealingOverTime, 1, 5f, 1f, 5f));
            // Add more as needed
        }

        /// &lt;summary&gt;
        /// Applies a status effect to a target entity.
        /// (TDD 18.3.1: Application)
        /// &lt;/summary&gt;
        public void ApplyEffect(EntityID targetID, StatusEffectData effectData, EntityID sourceID = default)
        {
            if (!_entityManager.IsValid(targetID))
            {
                GD.PrintErr($&quot;StatusEffectSystem: Attempted to apply effect to invalid entity {targetID}.&quot;);
                return;
            }
            if (!_effectDefinitions.TryGetValue(effectData.EffectID, out EffectDefinition def))
            {
                GD.PrintErr($&quot;StatusEffectSystem: Effect definition '{effectData.EffectID}' not found.&quot;);
                return;
            }

            if (!_activeEffects.ContainsKey(targetID))
            {
                _activeEffects[targetID] = new List&lt;ActiveEffect&gt;();
            }

            // Check if the target already has this effect (TDD 18.3.1)
            int existingEffectIndex = _activeEffects[targetID].FindIndex(ae =&gt; ae.Definition.ID == def.ID);

            if (existingEffectIndex != -1)
            {
                // Effect already exists: Refresh duration or stack (TDD 18.3.1)
                ActiveEffect existingEffect = _activeEffects[targetID][existingEffectIndex];

                // Refresh duration
                existingEffect.TimeRemaining = def.BaseDuration;

                // Stack if allowed
                if (existingEffect.Stacks &lt; def.MaxStacks)
                {
                    existingEffect.Stacks++;
                    GD.Print($&quot;StatusEffectSystem: Stacked '{def.ID}' on {targetID}. New stacks: {existingEffect.Stacks}&quot;);
                }
                _activeEffects[targetID][existingEffectIndex] = existingEffect; // Update struct in list

                // Emit event for UI/VFX update (e.g., stack count changed)
                _eventBus.Publish(new EffectUpdatedEvent { TargetID = targetID, Effect = existingEffect, IsNew = false });
            }
            else
            {
                // New effect: Create and add
                ActiveEffect newEffect = new ActiveEffect(def, targetID, sourceID, def.BaseDuration, effectData.Strength);
                _activeEffects[targetID].Add(newEffect);
                GD.Print($&quot;StatusEffectSystem: Applied new effect '{def.ID}' to {targetID}.&quot;);

                // Emit event for UI/VFX update (e.g., new icon, particle effect)
                _eventBus.Publish(new EffectAppliedEvent { TargetID = targetID, Effect = newEffect });
            }
        }

        /// &lt;summary&gt;
        /// Main update loop for the StatusEffectSystem.
        /// Called during GameManager._PhysicsProcess (Phase 2).
        /// (TDD 18.3.2: The Tick Loop)
        /// &lt;/summary&gt;
        public void Tick(double delta)
        {
            List&lt;EntityID&gt; entitiesToRemoveEffectsFrom = new List&lt;EntityID&gt;();

            foreach (var kvp in _activeEffects)
            {
                EntityID targetID = kvp.Key;
                List&lt;ActiveEffect&gt; effectsOnTarget = kvp.Value;

                if (!_entityManager.IsValid(targetID))
                {
                    entitiesToRemoveEffectsFrom.Add(targetID); // Mark for cleanup
                    continue;
                }

                List&lt;ActiveEffect&gt; effectsToRemove = new List&lt;ActiveEffect&gt;();
                for (int i = effectsOnTarget.Count - 1; i &gt;= 0; i--)
                {
                    ActiveEffect effect = effectsOnTarget[i];
                    effect.TimeRemaining -= (float)delta;
                    effect.TimeSinceLastTick += (float)delta;

                    // Apply effect tick (TDD 18.3.2)
                    if (effect.Definition.TickRate &gt; 0 &amp;&amp; effect.TimeSinceLastTick &gt;= effect.Definition.TickRate)
                    {
                        ApplyEffectTick(targetID, effect);
                        effect.TimeSinceLastTick = 0; // Reset tick timer
                    }

                    // Check for expiration (TDD 18.3.2)
                    if (!effect.Definition.IsPermanent &amp;&amp; effect.TimeRemaining &lt;= 0)
                    {
                        effectsToRemove.Add(effect);
                        GD.Print($&quot;StatusEffectSystem: Effect '{effect.Definition.ID}' expired on {targetID}.&quot;);
                    }
                    else
                    {
                        effectsOnTarget[i] = effect; // Update the struct in the list
                    }
                }

                // Remove expired effects
                foreach (var expiredEffect in effectsToRemove)
                {
                    effectsOnTarget.Remove(expiredEffect);
                    _eventBus.Publish(new EffectRemovedEvent { TargetID = targetID, EffectID = expiredEffect.Definition.ID });
                }

                if (effectsOnTarget.Count == 0)
                {
                    entitiesToRemoveEffectsFrom.Add(targetID);
                }
            }

            // Clean up entities with no active effects
            foreach (var id in entitiesToRemoveEffectsFrom)
            {
                _activeEffects.Remove(id);
            }
        }

        /// &lt;summary&gt;
        /// Applies the periodic effect of an active status effect.
        /// (TDD 18.3.2)
        /// &lt;/summary&gt;
        private void ApplyEffectTick(EntityID targetID, ActiveEffect effect)
        {
            if (!_biologicalSystem.TryGetCoreStats(targetID, out CoreStats coreStats)) return;

            float strength = effect.Definition.BaseStrength * effect.Stacks; // Strength scales with stacks

            switch (effect.Definition.Type)
            {
                case EffectType.DamageOverTime:
                    // Apply direct damage (GDD B12.4: Cumulative Injuries)
                    GameManager.Instance.Combat.ApplyDamage(effect.SourceID, targetID, strength, DamageType.Physical); // DoT is typically physical/elemental
                    break;
                case EffectType.HealingOverTime:
                    // Apply healing (GDD B12.11: Natural Healing Speed)
                    ref CoreStats targetStatsHeal = ref _biologicalSystem.GetCoreStatsRef(targetID);
                    targetStatsHeal.Health = Mathf.Min(targetStatsHeal.MaxHealth, targetStatsHeal.Health + strength);
                    _eventBus.Publish(new PlayerStatSystem.PlayerHealthChangedEvent { PlayerID = targetID, NewValue = targetStatsHeal.Health, MaxValue = targetStatsHeal.MaxHealth });
                    break;
                case EffectType.ChakraDrain:
                    ref CoreStats targetStatsChakra = ref _biologicalSystem.GetCoreStatsRef(targetID);
                    targetStatsChakra.Chakra = Mathf.Max(0, targetStatsChakra.Chakra - strength);
                     _eventBus.Publish(new PlayerStatSystem.PlayerChakraChangedEvent { PlayerID = targetID, NewValue = targetStatsChakra.Chakra, MaxValue = targetStatsChakra.MaxChakra });
                    break;
                case EffectType.StabilityDrain:
                    ref CoreStats targetStatsStability = ref _biologicalSystem.GetCoreStatsRef(targetID);
                    targetStatsStability.Stability = Mathf.Max(0, targetStatsStability.Stability - strength);
                    _eventBus.Publish(new PlayerStatSystem.PlayerStabilityChangedEvent { PlayerID = targetID, NewValue = targetStatsStability.Stability, MaxValue = targetStatsStability.MaxStability });
                    break;
                case EffectType.VoidSickness: // TDD 18.4.1
                    // Apply long-term void sickness effects here (e.g., reduce MaxHealth/Chakra, random miscasts)
                    GD.Print($&quot;StatusEffectSystem: {targetID} suffering Void Sickness tick (Stacks: {effect.Stacks}).&quot;);
                    // Example: reduce max health permanently
                    // ref CoreStats voidStats = ref _biologicalSystem.GetCoreStatsRef(targetID);
                    // voidStats.MaxHealth -= strength * 0.1f; // Small permanent max health reduction per tick
                    break;
                // StatModifier and ControlImpair effects are typically applied continuously/on demand, not per tick.
            }
        }

        /// &lt;summary&gt;
        /// Retrieves all active effects on a specific entity.
        /// &lt;/summary&gt;
        public IReadOnlyList&lt;ActiveEffect&gt; GetActiveEffects(EntityID targetID)
        {
            if (_activeEffects.TryGetValue(targetID, out List&lt;ActiveEffect&gt; effects))
            {
                return effects.AsReadOnly();
            }
            return new List&lt;ActiveEffect&gt;().AsReadOnly();
        }

        // --- Helper Events for Body Sync ---
        public struct EffectAppliedEvent { public EntityID TargetID; public ActiveEffect Effect; }
        public struct EffectUpdatedEvent { public EntityID TargetID; public ActiveEffect Effect; public bool IsNew; } // IsNew for UI to know if to create/update
        public struct EffectRemovedEvent { public EntityID TargetID; public string EffectID; }
    }
}
</code></pre>
<h3 id="5-integrating-statuseffectsystem-into-gamemanager">5. Integrating <code>StatusEffectSystem</code> into <code>GameManager</code></h3>
<p>We already added the <code>StatusEffectSystem</code> property and initialized it. We just need to ensure <code>BiologicalSystem</code> is passed to its constructor.</p>
<pre><code class="language-csharp">// _Brain/Core/GameManager.cs (inside InitializeSystems)
// ...
        BiologicalSystem = new BiologicalSystem(Entities, Events, Transforms, Movement, Weather);
        GD.Print(&quot;  - BiologicalSystem initialized.&quot;);

        // Initialize StatusEffectSystem, passing BiologicalSystem
        StatusEffects = new StatusEffectSystem(Entities, Events, BiologicalSystem); // Pass BiologicalSystem
        GD.Print(&quot;  - StatusEffectSystem initialized.&quot;);
// ...
</code></pre>
<h3 id="6-updating-damagesystemcs-to-use-statuseffectsystem">6. Updating <code>DamageSystem.cs</code> to use <code>StatusEffectSystem</code></h3>
<p>Our <code>DamageSystem</code> placeholder now needs to use the fully implemented <code>StatusEffectSystem</code>.</p>
<ol>
<li>Open <code>res://_Brain/Systems/Combat/DamageSystem.cs</code>.</li>
<li>Uncomment the <code>_statusEffectSystem.ApplyEffect()</code> call in <code>GenerateWounds()</code>.</li>
</ol>
<pre><code class="language-csharp">// _Brain/Systems/Combat/DamageSystem.cs
using Godot;
using System;
using Sigilborne.Core;
using Sigilborne.Entities;
using Sigilborne.Systems.Biology;
using Sigilborne.Systems.StatusEffects; // Ensure this is present

namespace Sigilborne.Systems.Combat
{
    // ... (DamageType, DamageResult structs/enums) ...

    public class DamageSystem
    {
        // ... (existing fields and constructor) ...

        public DamageResult ApplyDamage(EntityID attackerID, EntityID defenderID, float rawDamage, DamageType damageType, float penetration = 0f)
        {
            // ... (existing damage calculation and health application) ...

            // 4. Wound Generation (TDD 03.4) - Chance to create a StatusEffect
            GenerateWounds(defenderID, result);

            // ... (existing defeat logic) ...
        }

        private void GenerateWounds(EntityID targetID, DamageResult result)
        {
            if (result.FinalDamage &lt;= 0) return;

            float woundChance = result.FinalDamage / _biologicalSystem.GetCoreStatsRef(targetID).MaxHealth;
            if (woundChance &gt; 0.1f)
            {
                Random rand = new Random(targetID.Index + (int)GameManager.Instance.Time.CurrentGameTime);
                if (rand.NextDouble() &lt; woundChance)
                {
                    string effectId = &quot;&quot;;
                    float duration = 0;
                    float strength = 0;

                    switch (result.Type)
                    {
                        case DamageType.Physical:
                            effectId = &quot;bleed_t1&quot;;
                            duration = 5f;
                            strength = result.FinalDamage * 0.05f;
                            break;
                        case DamageType.Elemental:
                            effectId = &quot;burn_t1&quot;;
                            duration = 3f;
                            strength = result.FinalDamage * 0.03f;
                            break;
                        case DamageType.Chakra:
                            effectId = &quot;chakra_drain_t1&quot;;
                            duration = 2f;
                            strength = result.FinalDamage * 0.02f;
                            break;
                        case DamageType.Residue:
                            effectId = &quot;void_sickness_t1&quot;;
                            duration = 10f; // TDD 18.4.1 says permanent, but for test, give a duration.
                            strength = result.FinalDamage * 0.01f;
                            break;
                        default:
                            return;
                    }

                    if (!string.IsNullOrEmpty(effectId))
                    {
                        // Now calling the real ApplyEffect method (uncommented)
                        _statusEffectSystem.ApplyEffect(targetID, new StatusEffectData(effectId, duration, strength), result.AttackerID);
                        // GD.Print($&quot;DamageSystem: {targetID} received wound: {effectId} (Strength: {strength:F1})&quot;); // StatusEffectSystem prints this now.
                    }
                }
            }
        }
    }
}
</code></pre>
<h3 id="7-update-eventbuscs-for-status-effect-events">7. Update <code>EventBus.cs</code> for Status Effect Events</h3>
<p>Open <code>res://_Brain/Core/EventBus.cs</code> and add delegates for <code>StatusEffectSystem</code>'s new events.</p>
<pre><code class="language-csharp">// _Brain/Core/EventBus.cs
using System;
using System.Collections.Concurrent;
using Godot;
using Sigilborne.Entities;
using Sigilborne.Systems.Biology;
using Sigilborne.Systems.Magic;
using Sigilborne.Systems.StatusEffects; // Add this using directive
using System.Collections.Generic;

namespace Sigilborne.Core
{
    public class EventBus
    {
        // ... (existing events) ...

        // Status Effect Events (TDD 18.3.1)
        public event Action&lt;EntityID, ActiveEffect&gt; OnEffectApplied;
        public event Action&lt;EntityID, ActiveEffect, bool&gt; OnEffectUpdated; // TargetID, Effect, IsNew (true if new, false if just stacked/refreshed)
        public event Action&lt;EntityID, string&gt; OnEffectRemoved; // TargetID, EffectID

        // ... (existing _commandBuffer) ...

        public void Publish&lt;TEvent&gt;(TEvent eventData)
        {
            // ... (existing publish conditions) ...
            else if (eventData is StatusEffectSystem.EffectAppliedEvent effectAppliedEvent) // New condition
            {
                OnEffectApplied?.Invoke(effectAppliedEvent.TargetID, effectAppliedEvent.Effect);
            }
            else if (eventData is StatusEffectSystem.EffectUpdatedEvent effectUpdatedEvent) // New condition
            {
                OnEffectUpdated?.Invoke(effectUpdatedEvent.TargetID, effectUpdatedEvent.Effect, effectUpdatedEvent.IsNew);
            }
            else if (eventData is StatusEffectSystem.EffectRemovedEvent effectRemovedEvent) // New condition
            {
                OnEffectRemoved?.Invoke(effectRemovedEvent.TargetID, effectRemovedEvent.EffectID);
            }
            else
            {
                GD.PrintErr($&quot;EventBus: Attempted to publish unknown event type: {typeof(TEvent).Name}. Ensure it's handled in Publish&lt;TEvent&gt;.&quot;);
            }
        }
        // ... (AddCommand and FlushCommands methods) ...
    }
}
</code></pre>
<h3 id="8-testing-status-effect-lifecycle">8. Testing Status Effect Lifecycle</h3>
<ol>
<li>Save all C# and GDScript files.</li>
<li>Run <code>Main.tscn</code>.</li>
<li>Load <code>Gameplay.tscn</code>.</li>
<li>Observe the console output. The <code>DamageSystem</code> will apply damage and now call <code>StatusEffectSystem.ApplyEffect</code>.<ul>
<li>You should see messages like:<ul>
<li><code>StatusEffectSystem: Applied new effect 'bleed_t1' to EntityID(1, Gen:1).</code></li>
<li><code>StatusEffectSystem: Effect 'bleed_t1' expired on EntityID(1, Gen:1).</code> (after 5 seconds for bleed_t1)</li>
<li><code>StatusEffectSystem: Applied new effect 'burn_t1' to EntityID(1, Gen:1).</code> (after high elemental damage)</li>
<li><code>StatusEffectSystem: Applied new effect 'void_sickness_t1' to EntityID(0, Gen:1).</code> (after residue damage to player)</li>
<li>You'll also see <code>DamageOverTime</code> ticks reducing health, <code>ChakraDrain</code> ticks reducing chakra, etc.</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>This confirms that:
*   <code>EffectDefinition</code>s are registered.
*   <code>DamageSystem</code> correctly calls <code>StatusEffectSystem.ApplyEffect()</code>.
*   <code>StatusEffectSystem</code> manages <code>ActiveEffect</code> instances, refreshes/stacks them, and ticks their effects.
*   Effects expire after their <code>TimeRemaining</code> (unless <code>IsPermanent</code>).
*   The <code>ApplyEffectTick</code> correctly applies damage, healing, or resource drain.</p>
<h3 id="summary">Summary</h3>
<p>You have successfully implemented the <strong>Status Effect System</strong> for Sigilborne, defining <code>EffectDefinition</code> as static blueprints and <code>ActiveEffect</code> as runtime instances. By designing <code>StatusEffectSystem</code> to manage their lifecyclefrom application and stacking/refreshing to periodic ticking and expirationyou've created a robust mechanism for handling buffs, debuffs, and wounds. This crucial system correctly integrates with <code>DamageSystem</code> and <code>BiologicalSystem</code> to modify <code>CoreStats</code>, strictly adhering to TDD 18.2's specifications and laying the groundwork for complex, lasting combat consequences.</p>
<h3 id="next-steps">Next Steps</h3>
<p>The next chapter will focus on <strong>Recovery Logic</strong>, detailing how entities heal naturally, manage stamina and chakra regeneration, and how these processes interact with status effects and environmental conditions.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.sections", "navigation.expand", "content.code.copy"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>